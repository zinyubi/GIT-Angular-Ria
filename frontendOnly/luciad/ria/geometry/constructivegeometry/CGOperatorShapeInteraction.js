function polylinePointLocationsToPolygonPointLocations(e,n,t){for(var o=0;o<e.elements.length;o++){var a=null;var l=true;for(var i=e.elements[o];null!==i&&(l||i!=e.elements[o]);i=i.next){l=false;if(i.getPointLocationOther()){var s=i.bundleStar;var r=true;if(null!==s)r=starHasEdgesOfOtherShape(i.otherShapeIndex,s);if(r){a=null;if(null!==i.next&&null!==s){var g;if(s.getIndex(i,1)>=0){var f=[];var c=s.getEdgeEnd(s.getIndex(i,1)).angle;s.getLocationToShape(i.otherShapeIndex,c,f);a=f[1]}}continue}}if(null===a)a=n.filledContains2D(i.pos,t);i.setPointLocationOther(a)}}}function polylineSegmentLocationsToPolygonSegmentLocations(e,n,t){for(var o=0;o<e.elements.length;o++){var a=true;for(var l=e.elements[o];null!==l&&(a||l!==e.elements[o]);l=l.next){a=false;if(null===l.next)continue;if(null!==l.otherLineSegment){var i=l.otherLineSegment;if(l.isOtherInvertedDirection())l.setSegmentLocationsOfOther(true,i.segmentLabel.locationRight[i.shapeIndex],i.segmentLabel.locationLeft[i.shapeIndex]);else l.setSegmentLocationsOfOther(true,i.segmentLabel.locationLeft[i.shapeIndex],i.segmentLabel.locationRight[i.shapeIndex])}else{var s=l.bundleStar;if(null!=s&&starHasEdgesOfOtherShape(l.otherShapeIndex,s)){var r=[];var g=s.getEdgeEnd(s.getIndex(l,1)).angle;s.getLocationToShape(l.otherShapeIndex,g,r);l.setSegmentLocationsOfOther(r[1],r[0],r[2])}else if(l.isPointInsideAreaOfOther()||null!==l.next&&l.next.isPointInsideAreaOfOther())l.setSegmentLocationsOfOther(true,true,true);else if(!l.getPointLocationOther()||null!=l.next&&!l.next.getPointLocationOther())l.setSegmentLocationsOfOther(false,false,false);else{var f=t.getAveragePoint(l.pos,l.next.pos);var c=n.filledContains2D(f,t);l.setSegmentLocationsOfOther(c,c,c)}}}}}function starHasEdgesOfOtherShape(e,n){for(var t=0;t<n.getNumEdgeEnds();t++)if(n.getEdgeEnd(t).segment.shapeIndex===e)return true;return false}function calculateSameLineSegmentsSinglePass(e,n){for(var t=0;t<e.elements.length;t++){var o=true;var a=e.elements[t];for(var l=a;null!==l&&(o||l!==a);l=l.next){o=false;if(null===l.next)continue;var i=l.bundleStar;if(null===i)i=l.next.bundleStar;if(null===i)continue;var s=i===l.bundleStar?+1:-1;for(var r=0;r<i.getNumEdgeEnds();r++){var g=i.getEdgeEnd(r);var f=g.segment;if(f===l)continue;var c=g.dir;var u=+1==s?l.next.pos:l.pos;var m=null;if(+1===c&&null!==f.next)m=f.next.pos;else if(-1==c)m=f.pos;if(null!==m){var S;if(n.pointsEqual(u,m)||!n.certainlyNoInteraction3Points(i.pos,m,u)&&n.isPointOnLineSegment(i.pos,m,u)){l.setOtherLineSegment(f,c!=s);if(null===f.otherLineSegment)f.setOtherLineSegment(l,c!=s)}}}}}}function calculateSameLineSegments(e,n,t){calculateSameLineSegmentsSinglePass(e,t);calculateSameLineSegmentsSinglePass(n,t)}function fillInSegmentLocations(e){for(var n=0;n<e.elements.length;n++){var t=true;for(var o=e.elements[n];null!==o&&(t||o!==e.elements[n]);o=o.next){t=false;if(null===o.next)continue;var a=o.getPointLocationOther();var l=o.next.getPointLocationOther();if(a&&l)if(null!==o.otherLineSegment)o.setSegmentLocationsOfOther(true,false,false);else o.setSegmentLocationsOfOther(false,false,false);else o.setSegmentLocationsOfOther(false,false,false)}}}export var CGOperatorShapeInteraction={operate:function(e,n,t,o){o.solveIntersections(e,n);calculateSameLineSegments(e,n,t);fillInSegmentLocations(e);fillInSegmentLocations(n);polylinePointLocationsToPolygonPointLocations(e,n,t);polylinePointLocationsToPolygonPointLocations(n,e,t);polylineSegmentLocationsToPolygonSegmentLocations(e,n,t);polylineSegmentLocationsToPolygonSegmentLocations(n,e,t)}};