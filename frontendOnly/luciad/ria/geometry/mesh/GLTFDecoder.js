import{URL as RIAUrl}from"../../util/URL.js";import{isDefined}from"../../util/Lang.js";export class GLTFDecoder{constructor(e){this._webWorkerPool=e}decode(e,r={}){const t={meshUrl:relPathToAbs(e),protocol:window.location.protocol,credentials:r.credentials,requestHeaders:r.requestHeaders,urlParams:isDefined(r.requestParameters)?RIAUrl.buildQueryString(r.requestParameters):void 0,legacyAxis:r.legacyAxis};return this._webWorkerPool.enqueue({command:"decodeGLTF",data:t},[])}parse3DTilesProperties(e,r,t){return this._webWorkerPool.enqueue({command:"parse3DTilesProperties",data:e,requestUrl:r,requestOptions:t},[e])}}function relPathToAbs(e){if(isAbsolutePath(e))return e;if("/"===e[0])return`${window.location.protocol}//${window.location.host}${e}`;let r;let t="";const o=window.location.href.replace(/[^\/]*$/,e.replace(/(\/|^)(?:\.?\/+)+/g,"$1"));let s=0;for(let e;e=o.indexOf("/../",s),e>-1;s=e+r){r=/^\/(?:\.\.\/)*/.exec(o.slice(e))[0].length;t=(t+o.substring(s,e)).replace(new RegExp(`(?:\\/+[^\\/]*){0,${(r-1)/3}}$`),"/")}return t+o.substr(s)}function isAbsolutePath(e){let r=new RegExp(`^(blob:)*${window.location.protocol}`,"i");if(e.match(r))return true;r=new RegExp("^(blob:)*https:","i");return!!e.match(r)}