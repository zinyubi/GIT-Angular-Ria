function printStackTrace(t){var e=(t=t||{guess:true}).e||null,n=!!t.guess;var r=new printStackTrace.implementation,o=r.run(e);return n?r.guessAnonymousFunctions(o):o}function Implementation(){this.sourceCache={}}Implementation.prototype=Object.create(Object.prototype);Implementation.prototype.constructor=Implementation;Implementation.prototype.run=function(t,e){t=t||this.createException();return this[e=e||this.mode(t)](t)};Implementation.prototype.createException=function(){try{this.undef()}catch(t){return t}};Implementation.prototype.mode=function(t){if(t["arguments"]&&t.stack)return"chrome";else if("string"===typeof t.message&&"undefined"!==typeof window&&window.opera){if(!t.stacktrace)return"opera9";if(t.message.indexOf("\n")>-1&&t.message.split("\n").length>t.stacktrace.split("\n").length)return"opera9";if(!t.stack)return"opera10a";if(t.stacktrace.indexOf("called from line")<0)return"opera10b";return"opera11"}else if(t.stack)return"firefox";return"other"};Implementation.prototype.instrumentFunction=function(t,e,n){var r=(t=t||window)[e];t[e]=function r(){n.call(this,printStackTrace().slice(4));return t[e]._instrumented.apply(this,arguments)};t[e]._instrumented=r};Implementation.prototype.deinstrumentFunction=function(t,e){if(t[e].constructor===Function&&t[e]._instrumented&&t[e]._instrumented.constructor===Function)t[e]=t[e]._instrumented};Implementation.prototype.chrome=function(t){var e=(t.stack+"\n").replace(/^\S[^\(]+?[\n$]/gm,"").replace(/^\s+(at eval )?at\s+/gm,"").replace(/^([^\(]+?)([\n$])/gm,"{anonymous}()@$1$2").replace(/^Object.<anonymous>\s*\(([^\)]+)\)/gm,"{anonymous}()@$1").split("\n");e.pop();return e};Implementation.prototype.firefox=function(t){return t.stack.replace(/(?:\n@:0)?\s+$/m,"").replace(/^\(/gm,"{anonymous}(").split("\n")};Implementation.prototype.opera11=function(t){var e="{anonymous}",n=/^.*line (\d+), column (\d+)(?: in (.+))? in (\S+):$/;var r=t.stacktrace.split("\n"),o=[];for(var a=0,i=r.length;a<i;a+=2){var c=n.exec(r[a]);if(c){var s=c[4]+":"+c[1]+":"+c[2];var u=c[3]||"global code";u=u.replace(/<anonymous function: (\S+)>/,"$1").replace(/<anonymous function>/,e);o.push(u+"@"+s+" -- "+r[a+1].replace(/^\s+/,""))}}return o};Implementation.prototype.opera10b=function(t){var e=/^(.*)@(.+):(\d+)$/;var n=t.stacktrace.split("\n"),r=[];for(var o=0,a=n.length;o<a;o++){var i=e.exec(n[o]);if(i){var c=i[1]?i[1]+"()":"global code";r.push(c+"@"+i[2]+":"+i[3])}}return r};Implementation.prototype.opera10a=function(t){var e="{anonymous}",n=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i;var r=t.stacktrace.split("\n"),o=[];for(var a=0,i=r.length;a<i;a+=2){var c=n.exec(r[a]);if(c){var s=c[3]||e;o.push(s+"()@"+c[2]+":"+c[1]+" -- "+r[a+1].replace(/^\s+/,""))}}return o};Implementation.prototype.opera9=function(t){var e="{anonymous}",n=/Line (\d+).*script (?:in )?(\S+)/i;var r=t.message.split("\n"),o=[];for(var a=2,i=r.length;a<i;a+=2){var c=n.exec(r[a]);if(c)o.push(e+"()@"+c[2]+":"+c[1]+" -- "+r[a+1].replace(/^\s+/,""))}return o};Implementation.prototype.other=function(t){return[t.toString()]};Implementation.prototype.stringifyArguments=function(t){var e=[];var n=Array.prototype.slice;for(var r=0;r<t.length;++r){var o=t[r];if(void 0===o)e[r]="undefined";else if(null===o)e[r]="null";else if(o.constructor)if(o.constructor===Array)if(o.length<3)e[r]="["+this.stringifyArguments(o)+"]";else e[r]="["+this.stringifyArguments(n.call(o,0,1))+"..."+this.stringifyArguments(n.call(o,-1))+"]";else if(o.constructor===Object)e[r]="#object";else if(o.constructor===Function)e[r]="#function";else if(o.constructor===String)e[r]='"'+o+'"';else if(o.constructor===Number)e[r]=o}return e.join(",")};Implementation.prototype.ajax=function(t){var e=this.createXMLHTTPObject();if(e)try{e.open("GET",t,false);e.send(null);return e.responseText}catch(t){}return""};Implementation.prototype.createXMLHTTPObject=function(){var t,e=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}];for(var n=0;n<e.length;n++)try{t=e[n]();this.createXMLHTTPObject=e[n];return t}catch(t){}};Implementation.prototype.isSameDomain=function(t){return"undefined"!==typeof location&&-1!==t.indexOf(location.hostname)};Implementation.prototype.getSource=function(t){if(!(t in this.sourceCache))this.sourceCache[t]=this.ajax(t).split("\n");return this.sourceCache[t]};Implementation.prototype.guessAnonymousFunctions=function(t){for(var e=0;e<t.length;++e){var n=/\{anonymous\}\(.*\)@(.*)/,r=/^(.*?)(?::(\d+))(?::(\d+))?(?: -- .+)?$/,o=t[e],a=n.exec(o);if(a){var i=r.exec(a[1]);if(i){var c=i[1],s=i[2],u=i[3]||0;if(c&&this.isSameDomain(c)&&s){var p=this.guessAnonymousFunction(c,s,u);t[e]=o.replace("{anonymous}",p)}}}}return t};Implementation.prototype.guessAnonymousFunction=function(t,e,n){var r;try{r=this.findFunctionName(this.getSource(t),e)}catch(e){r="getSource failed with url: "+t+", exception: "+e.toString()}return r};Implementation.prototype.findFunctionName=function(t,e){var n=/function\s+([^(]*?)\s*\(([^)]*)\)/;var r=/['"]?([0-9A-Za-z_]+)['"]?\s*[:=]\s*function\b/;var o=/['"]?([0-9A-Za-z_]+)['"]?\s*[:=]\s*(?:eval|new Function)\b/;var a="",i,c=Math.min(e,20),s,u;for(var p=0;p<c;++p){if((u=(i=t[e-p-1]).indexOf("//"))>=0)i=i.substr(0,u);if(i){a=i+a;if((s=r.exec(a))&&s[1])return s[1];if((s=n.exec(a))&&s[1])return s[1];if((s=o.exec(a))&&s[1])return s[1]}}return"(?)"};printStackTrace.implementation=Implementation;function formatFFStacktrace(t,e){var n=0;var r=e.length;var o=[t.name+": "+t.message];var a;for(;n<r;n++)if(""!==e[n]){a=e[n].indexOf("@");e[n]=[e[n].substring(0,a)||"<anonymous>",e[n].substring(a+1,e[n].length-1)];o.push("   at "+e[n][0]+" ("+e[n][1]+")")}return o}function toDumpFormat(t){var e=2;var n=t.length;var r=["Dump generated: "];for(;e<n;e++)r.push(t[e]);return r}function getFormattedStackTrace(t){var e=true;if(!t){e=false;try{throw new Error("")}catch(e){t=e}}var n;var r;if(t.stacktrace)n=t.stacktrace;else if(t.stack)n=t.stack;else return false;r=n.split("\n");if("undefined"!==typeof InstallTrigger&&-1!==r[0].indexOf("@http"))r=formatFFStacktrace(t,r);if("Error"===r[0])r[0]=t.name+": "+t.message;if(!e)r=toDumpFormat(r);return r.join("\n")}export var StackTrace={getStackTrace:function(t){var e=getFormattedStackTrace(t);if(e)return e;var n=printStackTrace({e:t});n.unshift(t.name+": "+t.message);return n.join("\n")},dumpStackTrace:function(){var t=getFormattedStackTrace();if(t){console["error"](t);return}var e=printStackTrace();e.splice(0,4);e.unshift("Dump generated: ");console["error"](e.join("\n"))}};