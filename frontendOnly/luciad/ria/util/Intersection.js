import{VecMath}from"./VecMath.js";export function rayEllipsoidIntersection(t,n,e,o,c,s){const r=o*e.a;const i=o*e.b;const u=undefined;const f=undefined;const a=undefined;const d=undefined;const y=undefined;const l=undefined;const x=raySphereIntersection(t.x/r,t.y/r,t.z/i,n.x/r,n.y/r,n.z/i,1,s);if(x){s.move3D(s.x*r,s.y*r,s.z*i);constrainPointByDistance(t,s,c)}return x}export function raySphereIntersection(t,n,e,o,c,s,r,i){let u=o-t;let f=c-n;let a=s-e;const d=Math.sqrt(u*u+f*f+a*a);if(d>1e-10){const t=1/d;u*=t;f*=t;a*=t}const y=t*u+n*f+e*a;const l=undefined;const x=y*y-(t*t+n*n+e*e-r*r);if(x>0){const o=-y-Math.sqrt(x);const c=-y+Math.sqrt(x);const s=o>=0?o:c;if(s<0)return false;i.move3D(t+s*u,n+s*f,e+s*a);return true}else return false}export function rayPlaneIntersection(t,n,e,o,c=true){const s=-VecMath.dot(t,e)+VecMath.dot(t,n);const r=VecMath.dot(t,o);if(0===r)return null;const i=s/r;if(!c&&i<0)return null;return{x:e.x+i*o.x,y:e.y+i*o.y,z:e.z+i*o.z}}export function constrainPointByDistance(t,n,e){const o=n.x-t.x;const c=n.y-t.y;const s=n.z-t.z;const r=Math.sqrt(o*o+c*c+s*s);if(e>0&&r>e){const i=undefined;const u=1/(1+.25*(r-e)/e);n.move3D(t.x+o*u,t.y+c*u,t.z+s*u)}}