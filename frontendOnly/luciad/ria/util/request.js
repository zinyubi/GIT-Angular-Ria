import{RequestError}from"../error/RequestError.js";import{mimeType}from"./mimeType.js";import{URL}from"./URL.js";export function request(e,t,r){const o=undefined;return(r?r.scheduleRequest().then((()=>fetch(e,t))):fetch(e,t)).then((t=>{r?.finishRequest();if(!t.ok){const r=`Unable to load URL ${e}, status: ${t.status}, statusText: ${t.statusText}`;throw new RequestError(r,t.status,t)}return t})).catch((t=>{if(t instanceof RequestError||"AbortError"===t.name)throw t;const r=`Unable to load URL ${e}. Error message: ${t.message}`;throw new RequestError(r,t.status,t.response)}))}export function urlWithParams(e,t){const r=e.split("?")[0];let o={};if("string"===typeof t)o=URL.parseQueryString("fakeUrl?"+t);else if("object"===typeof t)o=t;const n={...URL.parseQueryString(e),...o};const s=URL.buildQueryString(n);if(0==s.length)return r;else return`${r}?${s}`}export function handleResponseAs(e,t){if("arraybuffer"===t)return e.arrayBuffer();else if("blob"===t)return e.blob();else if("json"===t)return e.json();return e.text()}export function createFormPOSTRequest(e){const t={};const r=[];for(const t in e)if(e.hasOwnProperty(t)){const o=encodeURIComponent(t);const n=encodeURIComponent(e[t]);r.push(o+"="+n)}t.headers={"Content-Type":mimeType.form};t.body=r.join("&");t.method="POST";return t}