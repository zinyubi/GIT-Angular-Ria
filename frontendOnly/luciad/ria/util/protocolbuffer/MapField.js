import{Field}from"./Field.js";import{mapKey}from"./types.js";import*as util from"./util.js";import{isString}from"./util/lang.js";export class MapField extends Field{static className="MapField";constructor(e,t,o,r,i,n){super(e,t,r,void 0,void 0,i,n);if(!isString(o))throw TypeError("keyType must be a string");this.keyType=o;this.resolvedKeyType=null;this.map=true}get _PB_MAP_FIELD(){return true}static fromJSON(e,t){return new MapField(e,t.id,t.keyType,t.type,t.options,t.comment)}add(e){throw new Error("Method not implemented.")}toJSON(e){const t=Boolean(e?.keepComments);const{keyType:o,type:r,id:i,extend:n,options:s,comment:p}=this;const y={keyType:o,type:r,id:i,extend:n,options:s};if(null!==p&&t)y.comment=p;return y}resolve(){if(this.resolved)return this;if(void 0===mapKey[this.keyType])throw Error(`invalid key type: ${this.keyType}`);return super.resolve()}}export function d(e,t,o){const r="function"===typeof o?util.decorateType(o).name:"object"===typeof o&&o?util.decorateEnum(o).name:o;return(o,i)=>{util.decorateType(o.constructor).add(new MapField(i,e,t,r))}}