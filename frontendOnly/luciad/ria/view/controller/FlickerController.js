import{HandleEventResult}from"./HandleEventResult.js";import{GestureEventType}from"../input/GestureEventType.js";import{Controller}from"./Controller.js";import{EventedSupport}from"../../util/EventedSupport.js";export class FlickerController extends Controller{constructor(){super();this._layers=[[],[]];this._visibleIndex=0;this._eventedSupport=new EventedSupport(["LayersChange","VisibleIndexChange"],true)}onActivate(e){super.onActivate(e);const t=undefined;if(!!e._isSoftwareMap())throw new Error("FlickerController can only be used on a WebGLMap");this.invalidate()}onDeactivate(e){if(!e._isSoftwareMap())e.enableLayerFlickering([]);return super.onDeactivate(e)}set layers(e){if(e.length<2)throw new Error("You must specify at least 2 sets of layers to flicker between.");this._layers=e;if(this._visibleIndex>=this._layers.length)this.visibleIndex=0;this.invalidate();this._eventedSupport.emit("LayersChange",this._layers)}get layers(){return this._layers}set visibleIndex(e){if(e!==this._visibleIndex){if(e<0||e>=this._layers.length)throw new Error("The visible index must match with a layer group");this._visibleIndex=e;this.invalidate();this._eventedSupport.emit("VisibleIndexChange",this._visibleIndex)}}get visibleIndex(){return this._visibleIndex}invalidate(){const e=this.map;const t=e&&e.webGLContext?e.webGLContext?.isContextLost():false;if(e&&!e._isSoftwareMap()&&!t)if(0==this._layers.length)e.enableLayerFlickering([]);else{const t=[];for(let e=0;e<this._layers.length;e++)if(e!==this._visibleIndex)for(const i of this._layers[e])if(this._layers[this._visibleIndex].indexOf(i)<0)t.push(i);e.enableLayerFlickering(t)}super.invalidate()}onGestureEvent(e){if(e.type===GestureEventType.SINGLE_CLICK_UP||e.type===GestureEventType.DOUBLE_CLICK){this.visibleIndex=(this.visibleIndex+1)%this._layers.length;this.invalidate();return HandleEventResult.EVENT_HANDLED}if(e.type==GestureEventType.DOWN||e.type==GestureEventType.SINGLE_CLICK_CONFIRMED)return HandleEventResult.EVENT_HANDLED;return super.onGestureEvent(e)}on(e,t){if("Invalidated"===e)return super.on(e,t);if("Activated"===e)return super.on(e,t);if("Deactivated"===e)return super.on(e,t);return this._eventedSupport.on(e,t)}}