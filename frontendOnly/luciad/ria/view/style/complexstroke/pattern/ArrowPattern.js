import{ProgrammingError}from"../../../../error/ProgrammingError.js";import{ArrowType}from"../ArrowType.js";import{WrapperPattern}from"./WrapperPattern.js";import{Stroked}from"./util/Stroked.js";import{Filled}from"./util/Filled.js";import{PatternType}from"./util/PatternType.js";import{PolylinePattern}from"./PolylinePattern.js";import{AllowOverlapPattern}from"./AllowOverlapPattern.js";import{LinePattern}from"./LinePattern.js";import{AtomicPattern}from"./AtomicPattern.js";import{AppendPattern}from"./AppendPattern.js";import{isBoolean,isNumber}from"../../../../util/Lang.js";export class ArrowPattern extends WrapperPattern{constructor(r){super(makeArrowPattern(r),PatternType.ARROW);this._arrowOptions=r;this._stroked=new Stroked({color:r.lineColor,width:r.lineWidth});this._filled=new Filled({color:r.fillColor})}get arrowOptions(){return this._arrowOptions}get lineColor(){return this._stroked.lineColor}set lineColor(r){this._stroked.lineColor=r}get lineWidth(){return this._stroked.lineWidth}set lineWidth(r){this._stroked.lineWidth=r}get dashed(){return this._stroked.dashed}set dashed(r){this._stroked.dashed=r}strokePath(r){}get fillColor(){return this._filled.fillColor}set fillColor(r){this._filled.fillColor=r}fillPath(r){}paint(r,e,t,o){r.translate(this.arrowOptions.shiftX,this.arrowOptions.shiftY);super.paint(r,e,t,o);r.translate(-this.arrowOptions.shiftX,-this.arrowOptions.shiftY)}appendHash(r){r.appendString(this.arrowOptions.arrowType);r.appendDouble(this.arrowOptions.size);r.appendDouble(this.arrowOptions.height);r.appendDouble(this.arrowOptions.offset);r.appendBoolean(this.arrowOptions.forward);this._stroked.appendHash(r);this._filled.appendHash(r)}}export function normalizeArrowOptions(r){const e=(r=r||{}).fill||{};const t=r.line||{};return{arrowType:r.type||ArrowType.REGULAR_FILLED,size:isNumber(r.size)?r.size:5,height:isNumber(r.height)?r.height:-1,offset:isNumber(r.offset)?r.offset:0,forward:isBoolean(r.forward)?r.forward:true,lineWidth:isNumber(t.width)?t.width:2,lineColor:t.color||"rgb(0,0,0)",fillColor:e.color||"rgb(255,255,255)",shiftX:isNumber(r.shiftX)?r.shiftX:0,shiftY:isNumber(r.shiftY)?r.shiftY:0}}function makeArrowPattern(r){const{arrowType:e,size:t,height:o,offset:n,forward:i,lineWidth:l,lineColor:s,fillColor:a}=r;switch(e){case ArrowType.REGULAR_FILLED:return new PolylinePattern({points:createRegularArrowhead(o,t,i,n),line:{width:l,color:s},fill:{color:a}});case ArrowType.REGULAR_OUTLINED:return new PolylinePattern({points:createRegularArrowhead(o,t,i,n),line:{width:l,color:s}});case ArrowType.PLAIN:return new PolylinePattern({points:createPlainArrowhead(o,t,i,n,false),line:{width:l,color:s}});case ArrowType.PLAIN_OUTLINED:return new PolylinePattern({points:createPlainArrowhead(o,t,i,n,true),line:{width:l,color:s}});case ArrowType.PLAIN_FILLED:return new PolylinePattern({points:createPlainArrowhead(o,t,i,n,true),line:{width:l,color:s},fill:{color:a}});case ArrowType.LEFT_HALF:return new LinePattern({length:t,offset0:n+(i?o<0?t:o:0),offset1:n+(i?0:o<0?t:o),line:{width:l,color:s}});case ArrowType.RIGHT_HALF:return new AllowOverlapPattern(new LinePattern({length:t,offset0:n-(i?o<0?t:o:0),offset1:n-(i?0:o<0?t:o),line:{width:l,color:s}}),{overlapLeft:t-1,overlapRight:0});case ArrowType.DOUBLE_LEFT_HALF:{const r=t/2;const e=n+(i?o<0?t:o:0);const a=n+(i?0:o<0?t:o);return new AtomicPattern(new AppendPattern([new LinePattern({length:r,offset0:e,offset1:a,line:{width:l,color:s}}),new LinePattern({length:r,offset0:e,offset1:a,line:{width:l,color:s}})]))}case ArrowType.DOUBLE_RIGHT_HALF:{const r=t/2;const e=n-(i?o<0?t:o:0);const a=n-(i?0:o<0?t:o);return new AtomicPattern(new AppendPattern([new LinePattern({length:r,offset0:e,offset1:a,line:{width:l,color:s}}),new LinePattern({length:r,offset0:e,offset1:a,line:{width:l,color:s}})]))}case ArrowType.BLUNT:return new LinePattern({length:t,offset0:n+(i?o<0?.5*t:.5*t:-(o<0?.5*t:.5*t)),offset1:n+(i?-(o<0?.5*t:.5*t):o<0?.5*t:.5*t),line:{width:l,color:s}});default:throw new ProgrammingError(`Unknown arrow type: ${e}`)}}function createRegularArrowhead(r,e,t,o){const n=r<0?.25*e:.5*r;return t?[[e,o],[0,o+n],[.25*e,o],[0,o-n],[e,o]]:[[0,o],[e,o+n],[.75*e,o],[e,o-n],[0,o]]}function createPlainArrowhead(r,e,t,o,n){const i=r<0?e:.5*r;const l=t?[[0,o+i],[e,o],[0,o-i]]:[[e,o+i],[0,o],[e,o-i]];if(n)l.push([t?0:e,o+i]);return l}