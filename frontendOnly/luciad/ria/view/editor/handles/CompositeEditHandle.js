import{EVENT_IGNORED,isHandled,isRequestDeactivation}from"../../controller/HandleEventResult.js";import{EditHandle}from"../EditHandle.js";import{PointHandle}from"./PointHandle.js";import{squaredViewDistance}from"./HandleUtil.js";import{Log}from"../../../util/Log.js";import{isDefined}from"../../../util/Lang.js";export class CompositeEditHandle extends EditHandle{constructor(e){super();this._handles=e.slice();this._handleListeners=[];for(const e of this._handles){this._handleListeners.push(e.on("EditShape",(e=>{this.eventedSupport.emit("EditShape",e)})));this._handleListeners.push(e.on("Invalidated",(()=>{this.eventedSupport.emit("Invalidated")})))}this._activeHandleIndex=-1;if(isDefined(arguments[1])&&true===arguments[1].cascading)Log.warn("CompositeEditHandleConstructorOptions.cascading has been removed. Please use 'new CascadingEditHandle()' instead.")}get handles(){return this._handles}set handles(e){for(const e of this._handleListeners)e.remove();this._handleListeners=[];this._handles=e;for(const e of this._handles){const t=e.on("EditShape",(e=>{this.eventedSupport.emit("EditShape",e)}));this._handleListeners.push(t)}}set activeHandleIndex(e){this._activeHandleIndex=e}onDraw(e,t){for(let n=0;n<this._handles.length;n++)this._handles[n].onDraw(e,t)}onDrawLabel(e,t){for(let n=0;n<this._handles.length;n++)this._handles[n].onDrawLabel(e,t)}shouldPaintFeature(e){for(const t of this._handles)if(t.shouldPaintFeature(e))return true;return false}update(){for(let e=0;e<this._handles.length;e+=1)this._handles[e].update()}onCreateContextMenu(e,t,n,s){for(const i of this._handles)i.onCreateContextMenu(e,t,n,s)}onGestureEvent(e,t){let n=EVENT_IGNORED;if(this._activeHandleIndex>=0){const s=undefined;n=this._handles[this._activeHandleIndex].onGestureEvent(e,t);if(!isHandled(n)||isRequestDeactivation(n))this._activeHandleIndex=-1}if(!isHandled(n)){const s=this.findInteractionHandles(e,t);for(let i=0;i<s.length;i++){n=s[i].onGestureEvent(e,t);if(isHandled(n)){if(!isRequestDeactivation(n))this._activeHandleIndex=this._handles.indexOf(s[i]);break}}}return n}findInteractionHandles(e,t){const n=[];for(let s=0;s<this._handles.length;s++){const i=this._handles[s];i.__lastEventSquaredDistance=Number.MAX_VALUE;n.push(i);if(i instanceof PointHandle)if(i.interacts(e,t)){const n=squaredViewDistance(t,i.getPoint(),e.viewPoint);i.__lastEventSquaredDistance=n}}n.sort(((e,t)=>e.__lastEventSquaredDistance-t.__lastEventSquaredDistance));return n}getCursor(e,t){if(this._activeHandleIndex>=0)return this._handles[this._activeHandleIndex].getCursor(e,t);const n=this.findInteractionHandles(e,t);for(let s=0;s<n.length;s++){const i=n[s].getCursor(e,t);if(i)return i}return null}}