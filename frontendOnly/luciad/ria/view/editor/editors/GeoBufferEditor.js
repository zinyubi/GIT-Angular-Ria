import{ShapeType}from"../../../shape/ShapeType.js";import{EditContext}from"../../controller/EditContext.js";import{Editor}from"../Editor.js";import{CompositeEditHandle}from"../handles/CompositeEditHandle.js";import{GeoBufferInvalidateHandle}from"../handles/GeoBufferInvalidateHandle.js";import{GeoBufferWidthHandle}from"../handles/GeoBufferWidthHandle.js";import{ShapeTranslateHandle}from"../handles/ShapeTranslateHandle.js";import{getDefaultSize}from"../handles/CreateByTemplateHandle.js";import{removeNullHandles}from"../handles/HandleUtil.js";import{GeoBufferHelperHandle}from"../handles/helper/GeoBufferHelperHandle.js";import{mergeMinMaxPointCount}from"../../controller/EditSettings.js";import{HelperHandle}from"../handles/helper/HelperHandle.js";class GeoBufferCreationHelperHandle extends HelperHandle{constructor(e,t){super(t);this._geoBuffer=e}onDraw(e,t){const a=this.getHelperStyle(t);if(a)e.drawShape(this._geoBuffer.baseShape,a)}}export class GeoBufferEditor extends Editor{constructor(e){super();this._baseShapeEditor=e}get baseShapeEditor(){return this._baseShapeEditor}canEdit(e){return ShapeType.contains(ShapeType.GEO_BUFFER,e.shape.type)}getEditHandles(e){const t=e.shape;const a=this.createWidthHandle(e);const n=this.createBaseShapeHandles(e);const r=new CompositeEditHandle(n);const s=undefined;const o=new GeoBufferInvalidateHandle(t,{handleDelegate:r,geoBuffersToInvalidate:[t],invalidateOnDeactivate:true,invalidateOnHandled:false});const d=this.createHelperHandle(e);return removeNullHandles([o,a,d,this.createTranslateHandle(e)])}createTranslateHandle(e){const t=e.shape;const a=new ShapeTranslateHandle(t);const n=undefined;return new GeoBufferInvalidateHandle(t,{handleDelegate:a,geoBuffersToInvalidate:[t],invalidateOnDeactivate:true,invalidateOnHandled:false})}createBaseShapeHandles(e){const t=e.shape;const a=mergeMinMaxPointCount(e.settings,t.baseShape);const n=new EditContext(e.map,e.layer,e.feature,t.baseShape,a);if(this.baseShapeEditor.canEdit(n))return this.baseShapeEditor.getEditHandles(n);return[]}createWidthHandle(e){const t=e.shape;return new GeoBufferWidthHandle(t)}createHelperHandle(e){const t=e.shape;return new GeoBufferHelperHandle(t)}getCreateHandle(e){const t={...e.settings,freehand:false};const a=e.shape;a.width=getDefaultSize(e.map)/7.5;const n=new EditContext(e.map,e.layer,e.feature,a.baseShape,t);const r=this.baseShapeEditor.getCreateHandle(n);const s=new GeoBufferCreationHelperHandle(a);const o=undefined;return new CompositeEditHandle([r,s])}}