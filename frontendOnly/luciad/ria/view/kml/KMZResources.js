import{BASE64_PREFIX}from"../../util/kml/KMLInternalUtil.js";export class KMZResources{constructor(){this._urlResources=new Map}async setResources(e){const s=fetchImageResources(e);if(0===s.length)return;const t=s.filter((e=>this.testResourceShouldBeResolved(e))).map((e=>this.resolveResource(e)));await Promise.all(t)}hasResources(){return this._urlResources.size>0}getKmzResource(e){const s=this._urlResources.get(e);if(s){const{base64Url:e,image:t}=s;return{base64Url:e,image:t}}}testResourceShouldBeResolved(e){const s=this._urlResources.get(e.name);if(!s)return true;return e.date.getTime()!==s.date.getTime()}async resolveResource(e){const s=await e.async("base64");const t=`${BASE64_PREFIX}${s}`;const r=await getImageFromBase64(t);this._urlResources.set(e.name,{base64Url:t,image:r,date:e.date})}__setTestResource(e,s,t,r){this._urlResources.set(e,{base64Url:s,image:t,date:r})}}async function getImageFromBase64(e){return new Promise((s=>{const t=new Image;t.onload=()=>s(t);t.src=e}))}function fetchImageResources(e){return[...e.file(/\.png$/i),...e.file(/\.(jpg|jpeg)$/i),...e.file(/\.gif$/i),...e.file(/\.tiff$/i)]}