import{LLHPoint}from"../shape/LLHPoint.js";import{Constants}from"../util/Constants.js";import{Hash}from"../util/Hash.js";import{isNumber,isObject,isString}from"../util/Lang.js";import{DEFAULT,Ellipsoid}from"./Ellipsoid.js";const tempLLHPoint=new LLHPoint;const REFERENCE=1;const SIMPLE=2;const COMPLEX=3;const TEN_PARAM=4;export class GeodeticDatum{constructor(t){this._name="";this._ellipsoid=DEFAULT;this._refDatum=this;this._x=0;this._y=0;this._z=0;this._rotX=0;this._rotY=0;this._rotZ=0;this._scale=1;this._pivotX=0;this._pivotY=0;this._pivotZ=0;this._primeMeridian=0;this._meridianCos=1;this._meridianSin=0;this._type=0;this._hash=0;let i=0,s=0,e=0,o=0,h=0,r=0,_=1,n=0,a=0,p=0,l=0,m=DEFAULT,d,c=this;if((isObject(t)||Array.isArray(t))&&null!==t){if(isNumber(t.x))i=t.x;if(isNumber(t.y))s=t.y;if(isNumber(t.z))e=t.z;if(isNumber(t.rotX))o=t.rotX;if(isNumber(t.rotY))h=t.rotY;if(isNumber(t.rotZ))r=t.rotZ;if(isNumber(t.scale))_=t.scale;if(isNumber(t.pivotX))n=t.pivotX;if(isNumber(t.pivotY))a=t.pivotY;if(isNumber(t.pivotZ))p=t.pivotZ;if(isNumber(t.primeMeridian))l=t.primeMeridian;if(isObject(t.ellipsoid)&&t.ellipsoid instanceof Ellipsoid)m=t.ellipsoid;if(isObject(t.ellipsoid)&&t.referenceDatum instanceof GeodeticDatum)c=t.referenceDatum;if(isString(t.name))d=t.name;else if(0==i&&0==s&&0==e&&0==o&&0==h&&0==r&&1==_&&0==n&&0==a&&0==p&&0==l&&m.equals(DEFAULT)&&c===this)d=m.name;else d="NO NAME"}else d=m.name;this.initialize(i,s,e,o,h,r,_,n,a,p,l,m,c,d)}initialize(t,i,s,e,o,h,r,_,n,a,p,l,m,d){this._x=t;this._y=i;this._z=s;this._rotX=e;this._rotY=o;this._rotZ=h;this._scale=r;this._pivotX=_;this._pivotY=n;this._pivotZ=a;this._primeMeridian=p;this._meridianCos=Math.cos(this._primeMeridian*Constants.DEG2RAD);this._meridianSin=Math.sin(this._primeMeridian*Constants.DEG2RAD);this._ellipsoid=l;this._refDatum=m;this._name=d;const c=new Hash;c.appendDouble(this._x).appendDouble(this._y).appendDouble(this._z).appendDouble(this._rotX).appendDouble(this._rotY).appendDouble(this._rotZ).appendDouble(this._scale).appendDouble(this._pivotX).appendDouble(this._pivotY).appendDouble(this._pivotZ).appendDouble(this._primeMeridian);this._ellipsoid.hashCode(c);this._hash=c.getHashCode();this.determineType()}determineType(){if(0==this._rotX&&0==this._rotY&&0==this._rotZ&&1==this._scale&&0==this._pivotX&&0==this._pivotY&&0==this._pivotZ&&0==this._primeMeridian)if(0==this._x&&0==this._y&&0==this._z)this._type=REFERENCE;else this._type=SIMPLE;else if(0==this._pivotX&&0==this._pivotY&&0==this._pivotZ)this._type=COMPLEX;else this._type=TEN_PARAM}getHeight(t,i){return 0}hasNonZeroHeights(){return false}equals(t){return this.equals2D(t)}equals2D(t){return t===this||t instanceof GeodeticDatum&&this._x==t._x&&this._y==t._y&&this._z==t._z&&this._rotX==t._rotX&&this._rotY==t._rotY&&this._rotZ==t._rotZ&&this._scale==t._scale&&this._pivotX==t._pivotX&&this._pivotY==t._pivotY&&this._pivotZ==t._pivotZ&&this._primeMeridian==t._primeMeridian&&this._ellipsoid.equals(t._ellipsoid)&&(this._refDatum._name==t._refDatum._name||this._refDatum._ellipsoid.equals(t._refDatum._ellipsoid))}geoc2geodSFCT(t,i){this._ellipsoid.geoc2geodSFCT(t,i);i.z-=this.getHeight(i.x,i.y)}geod2geocSFCT(t,i){tempLLHPoint.move3DToCoordinates(t.x,t.y,t.z);tempLLHPoint.z+=this.getHeight(t.x,t.y);this._ellipsoid.geod2geocSFCT(tempLLHPoint,i)}datum2refGeocSFCT(t,i){if(this._type==REFERENCE){i.x=t.x;i.y=t.y;i.z=t.z}else if(this._type==SIMPLE){i.x=t.x+this._x;i.y=t.y+this._y;i.z=t.z+this._z}else if(this._type==COMPLEX){const s=t.x;const e=t.y;const o=s*this._meridianCos-e*this._meridianSin;const h=s*this._meridianSin+e*this._meridianCos,r=t.z;i.x=this._scale*(o-this._rotZ*h+this._rotY*r)+this._x;i.y=this._scale*(h+this._rotZ*o-this._rotX*r)+this._y;i.z=this._scale*(r-this._rotY*o+this._rotX*h)+this._z}else{const s=t.x;const e=t.y;const o=t.z;const h=s*this._meridianCos-e*this._meridianSin-this._pivotX;const r=s*this._meridianSin+e*this._meridianCos-this._pivotY;const _=o-this._pivotZ;const n=this._scale*(h-this._rotZ*r+this._rotY*_)+this._pivotX+this._x;const a=this._scale*(r+this._rotZ*h-this._rotX*_)+this._pivotY+this._y;const p=this._scale*(_-this._rotY*h+this._rotX*r)+this._pivotZ+this._z;i.x=n;i.y=a;i.z=p}}ref2datumGeocSFCT(t,i){if(this._type==REFERENCE){i.x=t.x;i.y=t.y;i.z=t.z}else if(this._type==SIMPLE){i.x=t.x-this._x;i.y=t.y-this._y;i.z=t.z-this._z}else if(this._type==COMPLEX){const s=1+this._rotX*this._rotX+this._rotY*this._rotY+this._rotZ*this._rotZ;const e=this._scale*s;const o=(t.x-this._x)/e;const h=(t.y-this._y)/e;const r=(t.z-this._z)/e;const _=(1+this._rotX*this._rotX)*o+(this._rotX*this._rotY+this._rotZ)*h+(this._rotZ*this._rotX-this._rotY)*r;const n=(this._rotX*this._rotY-this._rotZ)*o+(1+this._rotY*this._rotY)*h+(this._rotY*this._rotZ+this._rotX)*r;const a=(this._rotZ*this._rotX+this._rotY)*o+(this._rotY*this._rotZ-this._rotX)*h+(1+this._rotZ*this._rotZ)*r;i.x=this._meridianCos*_+this._meridianSin*n;i.y=-this._meridianSin*_+this._meridianCos*n;i.z=a}else{const s=(t.x-this._x-this._pivotX)/this._scale;const e=(t.y-this._y-this._pivotY)/this._scale;const o=(t.z-this._z-this._pivotZ)/this._scale;const h=s+this._rotZ*e-this._rotY*o+this._pivotX;const r=-this._rotZ*s+e+this._rotX*o+this._pivotY;const _=this._rotY*s-this._rotX*e+o+this._pivotZ;i.x=this._meridianCos*h+this._meridianSin*r;i.y=-this._meridianSin*h+this._meridianCos*r;i.z=_}}withPrimeMeridian(t){if(t===this.primeMeridian)return this;return new GeodeticDatum({x:this.x,y:this.y,z:this.z,rotX:this.rotX,rotY:this.rotY,rotZ:this.rotZ,scale:this.scale,pivotX:this.pivotX,pivotY:this.pivotY,pivotZ:this.pivotZ,primeMeridian:t,ellipsoid:this.ellipsoid,referenceDatum:this.referenceDatum,name:this.name})}get name(){return this._name}get x(){return this._x}get y(){return this._y}get z(){return this._z}get rotX(){return this._rotX}get rotY(){return this._rotY}get rotZ(){return this._rotZ}get scale(){return this._scale}get pivotX(){return this._pivotX}get pivotY(){return this._pivotY}get pivotZ(){return this._pivotZ}get primeMeridian(){return this._primeMeridian}get ellipsoid(){return this._ellipsoid}get referenceDatum(){return this._refDatum}hashCode(t){t.appendUInt32(this._hash)}}