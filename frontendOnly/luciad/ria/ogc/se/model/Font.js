import{Log}from"../../../util/Log.js";import{sanitizeString}from"../util/SEUtil.js";import{SEElement}from"./SEElement.js";import{SEElementType}from"./SEElementType.js";import{SVGParameter}from"./SVGParameter.js";export const DEFAULT_FONT_SIZE_PX=10;const DEFAULT_FONT_SIZE=new SVGParameter("fontSize");DEFAULT_FONT_SIZE.addContent(""+DEFAULT_FONT_SIZE_PX);export class Font extends SEElement{static VALID_CHILDREN=["SvgParameter"];VALID_SVG_PARAMETERS=["font-family","font-style","font-weight","font-size"];_fontFamily=null;_fontStyle=null;_fontWeight=null;constructor(){super(SEElementType.FONT);this._fontSize=DEFAULT_FONT_SIZE}get fontFamily(){return this._fontFamily}get fontStyle(){return this._fontStyle}get fontWeight(){return this._fontWeight}get fontSize(){return this._fontSize}hasSVGParameter(t){return this.VALID_SVG_PARAMETERS.indexOf(t)>=0}addSVGParameter(t){switch(t.name){case this.VALID_SVG_PARAMETERS[0]:this._fontFamily=t;this._fontFamily.createStringEvaluationFunction(true);break;case this.VALID_SVG_PARAMETERS[1]:this._fontStyle=t;this._fontStyle.createStringEvaluationFunction(true);break;case this.VALID_SVG_PARAMETERS[2]:this._fontWeight=t;this._fontWeight.createStringEvaluationFunction(true);break;case this.VALID_SVG_PARAMETERS[3]:this._fontSize=t;this._fontSize.createNumberEvaluationFunction();break;default:break}}appendCssStyleTokens(t,e,n){if(this._fontFamily){const i=this._fontFamily.evaluateContentAsString(t,e,true);if(i.length>0)n.push(this._fontFamily.name+":"+i)}if(this._fontStyle){const i=sanitizeString(this._fontStyle.evaluateContentAsString(t,e,true));if(isAllowedFontStyle(i))n.push(this._fontStyle.name+":"+i)}if(this._fontWeight){const i=sanitizeString(this._fontWeight.evaluateContentAsString(t,e,true));if(isAllowedFontWeight(i))n.push(this._fontWeight.name+":"+i)}const i=this._fontSize.evaluateContentAsNumber(t,e);if(isNaN(i))Log.warn("font-size should be a number: "+i);else n.push(this._fontSize.name+":"+i+"px")}appendTextStyle(t,e,n){let i="normal";if(this._fontStyle){const n=sanitizeString(this._fontStyle.evaluateContentAsString(t,e,true));if(isAllowedFontStyle(n))i=n}let o=this._fontSize.evaluateContentAsNumber(t,e);if(isNaN(o)){Log.warn("font-size should be a number: "+o);o=DEFAULT_FONT_SIZE.evaluateContentAsNumber(t,e)}const s=o+"px";let a="normal";if(this._fontWeight){const n=sanitizeString(this._fontWeight.evaluateContentAsString(t,e,true));if(isAllowedFontWeight(n))a=n}let r="";if(this._fontFamily)r=this._fontFamily.evaluateContentAsString(t,e,true);n.font=`${i} ${a} ${s} ${r}`}}export const FONT_STYLE_POSSIBILITIES=["normal","italic","oblique"];export const FONT_WEIGHT_POSSIBILITIES=["normal","bold"];export function isAllowedFontStyle(t){return FONT_STYLE_POSSIBILITIES.indexOf(t)>=0}export function isAllowedFontWeight(t){return FONT_WEIGHT_POSSIBILITIES.indexOf(t)>=0}