import{SEElementType}from"./SEElementType.js";import{SEElement}from"./SEElement.js";import{Graphic}from"./Graphic.js";import{append,gap,repeatOverLength}from"../../../view/style/complexstroke/PatternFactory.js";export class GraphicStroke extends SEElement{static VALID_CHILDREN=["Graphic","InitialGap","Gap"];_initialGap=null;_gap=null;constructor(){super(SEElementType.GRAPHIC_STROKE);this._graphic=new Graphic}isReady(){return this._graphic.isReady()}get graphic(){return this._graphic}set graphic(e){this._graphic=e}get initialGap(){return this._initialGap}set initialGap(e){this._initialGap=e;this._initialGap?.createNumberEvaluationFunction()}get gap(){return this._gap}set gap(e){this._gap=e;this._gap?.createNumberEvaluationFunction()}createComplexStrokedLineStyle(e,t,a,i,r,p,n=0){const s=this._graphic.createIconStyle(e,t,i,r);const l=this._graphic.createIconPattern(s,n);let c=this.gap?.evaluateContentAsNumber(e,t)??0;c*=p;const o=s.offsetX?s.offsetX:0;let h=.5;if(s.anchorX){const e=undefined;h=Number(s.anchorX.replace("%",""))/100}let g=this.initialGap?.evaluateContentAsNumber(e,t)??0;if(0!==o)g+=o;if(.5!==h){const e=undefined;const t=undefined;g-=(h-.5)*(s.width?s.width:s.image.width)}g*=p;let u=l;if(0===c){if(g>0)u=append([gap(g,false),repeatOverLength(l,1,true)])}else if(0===g)u=append([l,gap(c,false)]);else if(g<=c)u=append([gap(g,false),l,gap(c-g,false)]);else u=append([gap(g-c,false),repeatOverLength(append([gap(c,false),l]),1,true)]);return{fallback:a,regular:u,uom:i}}}