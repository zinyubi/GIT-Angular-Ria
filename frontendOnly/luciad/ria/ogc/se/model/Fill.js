import{createCanvasColorString}from"../util/SEUtil.js";import{SEElement}from"./SEElement.js";import{SEElementType}from"./SEElementType.js";import{SVGParameter}from"./SVGParameter.js";import{isDefined}from"../../../util/Lang.js";export const DEFAULT_FILL_OPACITY=new SVGParameter("fillOpacity");DEFAULT_FILL_OPACITY.addContent("1");const DEFAULT_FILL_OPACITY_WHEN_COLOR_GIVEN=new SVGParameter("fill-opacity");DEFAULT_FILL_OPACITY_WHEN_COLOR_GIVEN.addContent("1");const DEFAULT_FILL="#808080";const DEFAULT_FILL_FOR_TEXT="rgba(0,0,0,1)";export class Fill extends SEElement{static VALID_CHILDREN=["GraphicFill","SvgParameter"];VALID_SVG_PARAMETERS=["fill","fill-opacity"];_graphicFill=null;_fillColor=null;_fillOpacity=null;constructor(){super(SEElementType.FILL)}isReady(){return null===this._graphicFill?Promise.resolve():this._graphicFill.isReady()}set graphicFill(t){this._graphicFill=t}get graphicFill(){return this._graphicFill}get fillColor(){return this._fillColor}get fillOpacity(){return this._fillOpacity}hasSVGParameter(t){return this.VALID_SVG_PARAMETERS.indexOf(t)>=0}addSVGParameter(t){t.eventedSupport=this.eventedSupport;switch(t.name){case this.VALID_SVG_PARAMETERS[0]:this._fillColor=t;this._fillColor.createStringEvaluationFunction(true);if(!this._fillOpacity)this._fillOpacity=DEFAULT_FILL_OPACITY_WHEN_COLOR_GIVEN;break;case this.VALID_SVG_PARAMETERS[1]:this._fillOpacity=t;this._fillOpacity.numberValidation={name:"fill-opacity",minValue:0,maxValue:1,defaultValue:1,clamp:true};this._fillOpacity.createNumberEvaluationFunction();break;default:break}}createFillStyle(t,e,i,l){let a=this.createSimpleFillStyle(t,e);if(this._graphicFill)a=this._graphicFill.createGraphicsFillStyle(t,e,a,i,l);return a}createSimpleFillStyle(t,e){const i=this._fillColor?.evaluateContentAsString(t,e,true);const l=this._fillOpacity?.evaluateContentAsNumber(t,e);return{color:isDefined(i)&&isDefined(l)?createCanvasColorString(i,l)??DEFAULT_FILL:DEFAULT_FILL}}appendCssStyleTokens(t,e,i){const l=this._fillColor?.evaluateContentAsString(t,e);const a=this._fillOpacity?.evaluateContentAsNumber(t,e);if(isDefined(l)&&isDefined(a))i.push("color"+":"+(createCanvasColorString(l,a)??DEFAULT_FILL_FOR_TEXT))}appendTextStyle(t,e,i){const l=this._fillColor?.evaluateContentAsString(t,e);const a=this._fillOpacity?.evaluateContentAsNumber(t,e);if(isDefined(l)&&isDefined(a))i.fill=createCanvasColorString(l,a)??DEFAULT_FILL_FOR_TEXT}}