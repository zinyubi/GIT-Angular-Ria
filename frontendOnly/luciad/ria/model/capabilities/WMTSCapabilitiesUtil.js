import{XML}from"../../util/XML.js";import{VersionNegotiator}from"./common/VersionNegotiator.js";import{WMSVersion}from"../../ogc/WMSVersion.js";import{addHttpRequestOptions}from"../../util/HttpRequestOptions.js";import{DEFAULT_WMTS_REQUEST_ENCODING,WMTSRequestEncoding}from"../tileset/WMTSRequestEncoding.js";import{request,urlWithParams}from"../../util/request.js";function parseVersion(e){const t=XML.stringToXml(e);let s=null;try{s=t.getElementsByTagName("Capabilities")[0].getAttribute("version")}catch(e){}return s}function createVersionNegotiator(e,t,s,r={},i=DEFAULT_WMTS_REQUEST_ENCODING){return new class extends VersionNegotiator{requestCapabilities(e){if(i&&i===WMTSRequestEncoding.REST){const e=urlWithParams(this.baseUrl,{...this.requestOptions.requestParameters});const t=addHttpRequestOptions({method:"GET",credentials:this.requestOptions.credentials,headers:this.requestOptions.requestHeaders},this.requestOptions);return request(e,t).then((e=>e.text()))}return super.requestCapabilities(e)}}(e,"WMTS",parseVersion,t||[WMSVersion.V100],s||null,r)}export const WMTSCapabilitiesUtil={parseVersion:parseVersion,createVersionNegotiator:createVersionNegotiator};