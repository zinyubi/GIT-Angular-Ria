import{clamp as clampNumber}from"../../util/Cartesian.js";const LEVEL_EPSILON=1e-6;export function getLevelByScalePixelDensity(t,e){return Math.log(t/e)/Math.log(2)}export function getScaleByLevelPixelDensity(t,e){return Math.pow(2,t)*e}function getXLevel(t,e){return getLevelByScalePixelDensity(t,e.getPixelDensity(0)[0])}export function getLevel(t,e){return getXLevel(t,e)}export function getGrid(t,e,o,n){getGridWithClamping(t,e,o,true,n)}export function getGridWithClamping(t,e,o,n,l){let i=getXLevel(o[0],t);const c=i%1;if(Math.abs(c)<=LEVEL_EPSILON)i=Math.round(i);const r=Math.min(Math.max(0,Math.ceil(i)),t.levelCount-1);const u=t.bounds;const s=t.getTileColumnCount(r);const a=t.getTileRowCount(r);const h=e.x-u.x;const g=e.y-u.y;const p=h+e.width;const m=g+e.height;const f=u.width/s;const x=u.height/a;let d=Math.floor(h/f);let M=Math.floor(g/x);let y=Math.floor(p/f);let L=Math.floor(m/x);if(n){const t=s-1;d=clampNumber(d,0,t);y=clampNumber(y,0,t);const e=a-1;M=clampNumber(M,0,e);L=clampNumber(L,0,e)}l.x=d;l.y=M;l.width=y-d+1;l.height=L-M+1;l.level=r}export function getTileBounds(t,e,o){return computeTileBounds(t,e.level,e.x,1,e.y,1,o)}export function getGridBounds(t,e,o){return computeTileBounds(t,e.level,e.x,e.width,e.y,e.height,o)}export function computeTileBounds(t,e,o,n,l,i,c){const r=t.getBounds(e);const u=t.getTileRowCount(e);const s=t.getTileColumnCount(e);const a=r.width/s;const h=r.height/u;if(!c)c=r.copy();c.setTo2D(r.x+a*o,a*n,r.y+h*l,h*i);return c}export function getParent(t,e,o){const n=t-1;const l=Math.pow(2,t-n);const i=[];if(n>=0){i[0]=n;i[1]=Math.floor(e/l);i[2]=Math.floor(o/l)}return i}