import{isDefined}from"../../util/Lang.js";export let WMTSRequestEncoding=function(e){e["KVP"]="KVP";e["REST"]="REST";return e}({});export const DEFAULT_WMTS_REQUEST_ENCODING=WMTSRequestEncoding.KVP;const restRegex=/^(?=.*(\{TileMatrix\}))(?=.*(\{TileRow\}))(?=.*(\{TileCol\})).*$/;const kvpRegex=/^(?=.*SERVICE=WMTS)(?=.*REQUEST=GetTile)(?=.*VERSION=\d+\.\d+\.\d+)(?=.*LAYER=[^&]+)(?=.*STYLE=[^&]*)(?=.*TILEMATRIXSET=[^&]+)(?=.*FORMAT=[^&]+)(?=.*TILEMATRIX=\d+)?(?=.*TILEROW=\d+)?(?=.*TILECOL=\d+)?.*$/i;export function resolveRequestEncodingFromRequestUrl(e){return/^.*\.(([xX])([mM])([lL]))(\?(.*))?$/.test(e)?WMTSRequestEncoding.REST:WMTSRequestEncoding.KVP}export function isBaseUrlRestEncoded(e){return restRegex.test(e)}export function isBaseUrlKvpEncoded(e){return kvpRegex.test(e)}export function getSupportedEncoding(e){return e.length>0?e.filter((e=>isSupportedEncoding(e))).map((e=>isStringRESTEncoding(e)?WMTSRequestEncoding.REST:WMTSRequestEncoding.KVP)):[]}export function filterCapabilitiesOperationByEncoding(e,n){return e.filter((e=>"GET"===e.requestMethod&&isEncodingsContainsType(e.encodings,n)))[0]}export function createWMTSGetOperationsEncodingInfo(e,n){const t={OperationsMetadataDeducedEncodings:{GetCapabilities:new Set,GetFeatureInfo:new Set,GetTile:new Set},restEncodingSupportedLayers:[]};for(let n in e)e[n].filter((e=>"GET"===e.requestMethod.toUpperCase())).flatMap((e=>getSupportedEncoding(e.encodings))).forEach((e=>t.OperationsMetadataDeducedEncodings[n].add(e)));for(const e of n)if(e.resourceUrls?.length>0)t.restEncodingSupportedLayers.push({LayerId:e.identifier,resources:e.resourceUrls.filter((e=>"TILE"===e.resourceType.toUpperCase()||"FEATUREINFO"===e.resourceType.toUpperCase())).map((e=>({format:e.format,resourceType:e.resourceType})))});return Object.freeze(t)}function isSupportedEncoding(e){return isStringRESTEncoding(e)||isStringKVPEncoding(e)}function isEncodingsContainsType(e,n){return e.some((e=>n===WMTSRequestEncoding.REST?isStringRESTEncoding(e):isStringKVPEncoding(e)))}function isStringKVPEncoding(e){return isDefined(e)&&"KVP"===e.toUpperCase()}function isStringRESTEncoding(e){return isDefined(e)&&("RESTFUL"===e.toUpperCase()||"REST"===e.toUpperCase())}