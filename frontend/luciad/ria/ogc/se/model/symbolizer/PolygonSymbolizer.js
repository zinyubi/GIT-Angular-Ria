import{SEElementType}from"../SEElementType.js";import{Fill}from"../Fill.js";import{LineSymbolizer}from"./LineSymbolizer.js";import{SVGParameter}from"../SVGParameter.js";import{Log}from"../../../../util/Log.js";import{SupportedVendorOptions}from"../VendorOption.js";const DEFAULT_FILL=new Fill;export const DEFAULT_FILL_COLOR=new SVGParameter("fill");DEFAULT_FILL_COLOR.addContent("#808080");DEFAULT_FILL.addSVGParameter(DEFAULT_FILL_COLOR);export class PolygonSymbolizer extends LineSymbolizer{static VALID_CHILDREN=(new Array).concat(LineSymbolizer.VALID_CHILDREN,["Fill","Displacement"]);static VALID_VENDOR_OPTIONS=[SupportedVendorOptions.VENDOR_OPTION_INCLUSION];_fill=null;_displacement=null;constructor(){super(SEElementType.POLYGON_SYMBOLIZER)}isReady(){const e=super.isReady();const t=null===this._fill?Promise.resolve():this._fill.isReady();return Promise.all([e,t]).then((()=>{}))}get validVendorOptions(){return PolygonSymbolizer.VALID_VENDOR_OPTIONS}get fill(){return this._fill}set fill(e){if(e)e.eventedSupport=this.eventedSupport;this._fill=e;if(!this._fill?.fillColor)this._fill?.addSVGParameter(DEFAULT_FILL_COLOR)}get displacement(){return this._displacement}set displacement(e){if(e){e.eventedSupport=this.eventedSupport;e.x.eventedSupport=this.eventedSupport;e.y.eventedSupport=this.eventedSupport}this._displacement=e}createStrokeFillStyle(e,t){const i=super.createStrokeFillStyle(e,t);if(i&&this.displacement){i.uom=this.uom;i.offsetX=this.displacement.x.evaluateContentAsNumber(e,t);i.offsetY=-this.displacement.y.evaluateContentAsNumber(e,t)}return i}createStrokeStyles(e,t,i){let l=0;let r=0;if(this.displacement){l=this.displacement.x.evaluateContentAsNumber(e,t);r=-this.displacement.y.evaluateContentAsNumber(e,t)}return super.createStrokeStyles(e,t,i,[l,r])}createFillStyle(e,t,i){if(!this._fill)return;else{let l;try{l=this._fill.createFillStyle(e,t,this.uom)}catch(i){Log.error("Symbology Encoding Painter - fillStyle for PolygonSymbolizer: "+(i instanceof Error?i.message:i));l=(new Fill).createFillStyle(e,t,this.uom)}if(l&&i&&this._perpendicularOffset){const i=this._perpendicularOffset.evaluateContentAsNumber(e,t);l.uom=this.uom;l.perpendicularOffset=i}if(l&&this.displacement){l.uom=this.uom;l.offsetX=this.displacement.x.evaluateContentAsNumber(e,t);l.offsetY=-this.displacement.y.evaluateContentAsNumber(e,t)}return l}}}