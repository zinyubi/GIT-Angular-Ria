import{base64}from"../../../util/base64.js";import{InlineContent}from"../model/InlineContent.js";import{Base64InlineContentEncoder}from"./Base64InlineContentEncoder.js";export class SvgXmlInlineContentEncoder extends Base64InlineContentEncoder{constructor(){super("xml")}validate(e,n){n.warnIfMoreThanOne(e.svgs,"InlineContent","svg")}encode(e){if(!this.canEncode(e.$attr.encoding))return null;const n=undefined;let t;const o=convertToBase64(e.svgs[0].$xml,false);if(!o)return null;const r=new InlineContent("base64");r.addContent(o);return r}}export function convertToBase64(e,n){let t=e.replace(/>\s*/g,">");t=t.replace(/\s*</g,"<");const o=(new DOMParser).parseFromString(t,"application/xml");let r=false;let s=null;o.childNodes.forEach(((e,t,o)=>{if(e instanceof SVGSVGElement){const t=e;const o=16;if(!t.getAttribute("height")){t.setAttribute("height",`${o}`);r=true}if(!t.getAttribute("width")){const e=t.viewBox.baseVal?t.viewBox.baseVal.width/t.viewBox.baseVal.height:1;const n=Math.round(o*e);t.setAttribute("width",`${n}`);r=true}if(r||!n){const e=(new XMLSerializer).serializeToString(t);s=base64.encode(e)}else s=null}}));return s}