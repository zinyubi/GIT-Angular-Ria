import{addHttpRequestOptions}from"../../util/HttpRequestOptions.js";import{isBoolean}from"../../util/Lang.js";import{Log}from"../../util/Log.js";import{request}from"../../util/request.js";import{XML}from"../../util/XML.js";import{ErrorHandler}from"../ErrorHandler.js";import{decodeXML}from"./decoding/SEDecoder.js";import{SEElementType}from"./model/SEElementType.js";import{SEPainter}from"./painter/SEPainter.js";const REQUEST_OPTIONS={};function parseOptionsObject(t){return{strict:isBoolean((t=t||{}).strict)?t.strict:false,conflictResolution:isBoolean(t.conflictResolution)?t.conflictResolution:true,iconProvider:t.iconProvider,functionEvaluators:t.functionEvaluators,requestOptions:t.requestOptions||{},drapeTarget:t.drapeTarget,painterType:t.painterType??"map"}}function createPainter(t,e){const r=new ErrorHandler(e);if(!t)r.fatal("Cannot build painter: no FeatureTypeStyle in Symbology Encoding definition");else{if(t.type!==SEElementType.FEATURE_TYPE_STYLE)r.fatal("Cannot build painter: no FeatureTypeStyle in Symbology Encoding definition");return t.isReady().then((()=>new SEPainter({featureTypeStyle:t,conflictResolution:e.conflictResolution,drapeTarget:e.drapeTarget,type:e.painterType})))}return r.fatal("No painter was built and no exception was thrown. This should not happen. Please contact your vendor")}const MODEL_CACHE=new Map;function createPainterFromData(t,e,r){try{let o=MODEL_CACHE.get(r);if(!o){o=decodeXML(t,e);MODEL_CACHE.set(r,o)}return createPainter(o,e)}catch(t){const e=t instanceof Error?t:void 0;Log.error("Error encountered",e);throw t}}export function createPainterFromURL(t,e){const r=parseOptionsObject(e);const o=addHttpRequestOptions(REQUEST_OPTIONS,e?.requestOptions);return request(t,o).then((t=>t.text())).then((e=>createPainterFromData(XML.stringToXml(e),r,t)))}export function createPainterFromString(t,e){return new Promise(((r,o)=>{try{r(createPainterFromData(XML.stringToXml(t),parseOptionsObject(e),t))}catch(t){o(t)}}))}