import{WFSVersion}from"../../ogc/WFSVersion.js";import{WFSRequestBuilderUtil}from"./WFSRequestBuilderUtil.js";import{isArray,isNumber,isString}from"../../util/Lang.js";const WFS_VERSIONS=[WFSVersion.V110,WFSVersion.V100,WFSVersion.V202,WFSVersion.V200];export class WFSGetFeatureRequestParameterBuilder{constructor(e,r=e){this._serviceURL=e;this._postServiceURL=r;this._supportedMethods=["GET","POST"];this._supportedVersions=[];this._preferredVersion=WFSVersion.V200;this.supportedVersions=WFS_VERSIONS}get supportedMethods(){return[...this._supportedMethods]}set supportedMethods(e){this._supportedMethods=[...e];if(!this.isSupportedMethod("POST")&&!this.isSupportedMethod("GET"))throw new Error("No supported WFS request methods available")}get supportedVersions(){return[...this._supportedVersions]}set supportedVersions(e){this._supportedVersions=[...e];for(let e=0;e<WFS_VERSIONS.length;e++){const r=WFS_VERSIONS[e];if(this._supportedVersions.indexOf(r)>=0){this._preferredVersion=r;break}}if(!this._preferredVersion)throw new Error("No supported WFS versions available")}build(e,r,s,t,i,o,p){const u=this._serviceURL;const d=this._postServiceURL;const n=undefined;const S={service:"WFS",request:"GetFeature",version:this._preferredVersion,outputFormat:s||"JSON",srsName:t,typeNames:e,filters:r,sortBy:p};if(isNumber(i))S.maxFeatures=i;if(isString(o)||isArray(o))S.propertyNames=isArray(o)?o:[o];const h=this.isSupportedMethod("POST");const a=this.isSupportedMethod("GET");if(h&&a)return WFSRequestBuilderUtil.buildPOSTorGETParams(u,d,S);else if(h)return WFSRequestBuilderUtil.buildPOSTParams(d,S);else if(a)return WFSRequestBuilderUtil.buildGETParams(u,S);throw new Error(`Did not find a supported method to perform WFS GetFeature request. [${this._supportedMethods.join(",")}] does not contain GET or POST.`)}isSupportedMethod(e){return this._supportedMethods.indexOf(e)>=0}}