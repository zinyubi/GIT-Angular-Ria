import{Affine3DTransformation,createChainedTransformation,createTranslationTransformation}from"../../transformation/Affine3DTransformation.js";import{Photon}from"../../gen/photon/photon_painter.js";var BufferFactory=Photon.BufferFactory;import{Matrix4}from"../../geometry/mesh/math/Matrix4.js";import{getReference}from"../../reference/ReferenceProvider.js";export class HSPCTile{constructor(t,r,e,n,i){this._id=t;this._data=e;this._layout=n;const s=new Matrix4;s.fromArray(i.typedArray);this._transformation=new TileTransformation(s,r);this._elementCount=n.computeElementCount(e.size)}getAttribute(t){try{return new HSPCAttribute(t,this._layout,this._data,this.numberOfPoints)}catch(t){return}}get points(){if(!this._points)try{this._pointsAttribute=new HSPCAttribute("Position",this._layout,this._data,this.numberOfPoints);this._points=new Float32Array(this._pointsAttribute.values)}catch(t){throw new Error("No points found")}return this._points}get numberOfPoints(){return this._elementCount}get transformation(){return this._transformation}get id(){return this._id}get rawData(){return this._data}}export class HSPCAttribute{constructor(t,r,e,n){this.name=t;this._layout=r;this._data=e;this._values=null;this._size=n;if(!this._layout.hasAttribute(t))throw Error("Attribute "+t+"doesn't exist")}get values(){if(!this._values){const t=this._layout.copyBuffer(this._data,this.name);this._values=Uint8Array.from(t.typedArray);t.release()}return this._values.buffer}set values(t){this._values=new Uint8Array(t);const r=BufferFactory.createUint8BufferFromData(this._values);this._layout.setBuffer(this._data,this.name,r);r.release()}get length(){return this._size}}export class TileTransformation extends Affine3DTransformation{constructor(t,r){const e=getReference("LUCIAD:XYZ");const n=createTranslationTransformation(r,{sourceReference:e});const i=new Affine3DTransformation(t,e,e);const s=undefined;super(createChainedTransformation(n,i).getTransformationMatrix(),e,e);this.localOrigin=r}}