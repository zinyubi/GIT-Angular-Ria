import{isString,isUndefined}from"../Lang.js";const IS_ABSOLUTE_URL=new RegExp("^(?:[a-z]+:)?//","i");function resolveHrefLink(e,n){const t=n.trim();const r=e.startsWith(BLOB_PREFIX)?e.slice(BLOB_PREFIX.length):e;if(!r||IS_ABSOLUTE_URL.test(t))return t;if(SLASH_CODE===t.charCodeAt(0)){const e="//";const n=r.indexOf(e);const i=r.indexOf("/",-1===n?0:n+e.length);return`${r.substring(0,i)}${t}`}const i=r.indexOf("?");const l=r.lastIndexOf("/",-1===i?void 0:i);if(-1===l)return t;return`${r.substring(0,l)}/${t}`}function resolveHrefWithResources(e,n,t){if(n.startsWith(BASE64_PREFIX))return n;if(t?.hasResources()){const e=t.getKmzResource(n);if(e)return e}return resolveHrefLink(e,n)}export function resolveHrefToResource(e,n,t){const r=resolveHrefWithResources(e,n,t);if(isString(r))return{url:r};return{url:r.base64Url,image:r.image}}const BLOB_PREFIX="blob:";const SLASH_CODE="/".charCodeAt(0);export const BASE64_PREFIX="data:application/octet-stream;base64,";export function xmlFindFirstChild(e,n){for(let t=e.firstElementChild;null!==t;t=t.nextElementSibling)if(n(t))return t;return null}export function xmlReduceChildren(e,n,t){let r=e.firstElementChild;let i=isUndefined(t)?r:t;if(null===r)return i;let l=0;if(isUndefined(i)){r=r.nextElementSibling;l=1}for(;null!==r;++l,r=r.nextElementSibling)i=n(i,r,l);return i}export function xmlWalkChildren(e,n){for(let t=0,r=e.firstElementChild;r;++t,r=r.nextElementSibling)n(r,t)}export function xmlFilterChildren(e,n){return xmlReduceChildren(e,((e,t,r)=>{if(n(t,r))e.push(t);return e}),[])}export function xmlFilterMapChildren(e,n){return xmlReduceChildren(e,((e,t,r)=>{const i=n(t,r);if(!isUndefined(i))e.push(i);return e}),[])}export function xmlFindFirstDescendant(e,n){for(let t=e.firstElementChild;null!==t;t=t.nextElementSibling){if(n(t))return t;const e=xmlFindFirstDescendant(t,n);if(null!==e)return e}return null}export function xmlNodeContains(e,n){for(let t=n;t;t=xmlParentNode(t))if(t===e)return true;return false}export function xmlParentNode(e){return e.parentNode}