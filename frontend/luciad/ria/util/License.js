import{request}from"./request.js";import{ProgrammingError}from"../error/ProgrammingError.js";import{isArray}from"./Lang.js";import{toUrlFromRoot}from"./Config.js";let licenseData=null;let fallBackLicenseData=null;export function getData(){if(licenseData)return licenseData.catch(loadLicenseFromFallbacks);return loadLicenseFromFallbacks()}function setLicenseText(e){licenseData=Promise.resolve(e)}function loadLicenseFromUrl(e){licenseData=fetchLicenseFromUrl(e);return licenseData}function fetchLicenseFromUrl(e){return new Promise(((r,t)=>{request(e,{method:"GET"}).then((e=>e.text())).then(r,t)}))}function loadLicenseFromUrls(e){const r=[];if(!isArray(e)||0===e.length){licenseData=null;return Promise.reject("URLs not provided")}const t=e.length;if(1===t)return loadLicenseFromUrl(e[0]);let n=0;licenseData=new Promise(((o,a)=>{for(let l=0;l<t;l++){const i=e[l];request(i,{method:"GET"}).then((e=>e.text())).then(o,(e=>{n+=1;r.push(e.message||""+e);if(n===t)a(new ProgrammingError(r.join("\n")))}))}}));return licenseData}function loadLicenseFromFallbacks(){if(!fallBackLicenseData)fallBackLicenseData=fetchLicenseFromUrl(toUrlFromRoot("license/luciadria_development.txt")).catch((function(){return fetchLicenseFromUrl(toUrlFromRoot("license/luciadria_deployment.txt"))}));return fallBackLicenseData}export{setLicenseText,loadLicenseFromUrl,loadLicenseFromUrls};