import{createHTML5Canvas}from"../view/HTML5Canvas.js";import{isString}from"./Lang.js";import{Hash}from"./Hash.js";const html5Canvas=createHTML5Canvas(0,0);const hash=new Hash;export function imageColorMultiply(e,a){const t=document.createElement("canvas");t.style.display="none";t.width=e.width;t.height=e.height;const n=t.getContext("2d",{willReadFrequently:true});if(!n)return null;else{n.drawImage(e,0,0);const s=n.getImageData(0,0,t.width,t.height);for(let e=0;e<s.data.length;e+=4){s.data[e]*=a.r;s.data[e+1]*=a.g;s.data[e+2]*=a.b;s.data[e+3]*=a.a}n.putImageData(s,0,0);return t}}export async function resizeImageOrCanvas(e,a,t){return new Promise(((n,s)=>{const h=a?a:e.width;const o=t?t:e.height;html5Canvas.width=h;html5Canvas.height=o;const r=html5Canvas.getContext("2d",{willReadFrequently:true});r.drawImage(e,0,0,h,o);const i=new Image(h,o);i.onerror=s;i.onload=()=>{r.clearRect(0,0,h,o);n(i)};i.src=html5Canvas.toDataURL()}))}export function getImageHash(e,a=0,t=0,n){let s="unknown";if(isString(e))s=e;else if(e instanceof HTMLImageElement&&e.src)s=e.src;else if(e instanceof HTMLCanvasElement)s=e.toDataURL();hash.reset();hash.appendString(s);if(a&&t){hash.appendDouble(a);hash.appendDouble(t)}if(n){hash.appendDouble(n.r);hash.appendDouble(n.g);hash.appendDouble(n.b);hash.appendDouble(n.a)}return hash.getHashCode()}