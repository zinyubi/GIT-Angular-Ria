import{isString}from"./lang.js";import{Long}from"./Long.js";export class LongBits{static zero=new LongBits(0,0);static zeroHash="\0\0\0\0\0\0\0\0";constructor(t,o){this.lo=t>>>0;this.hi=o>>>0}static fromNumber(t){if(0===t)return LongBits.zero;const o=t<0;if(o)t=-t;let i=t>>>0,r=(t-i)/4294967296>>>0;if(o){r=~r>>>0;i=~i>>>0;if(++i>4294967295){i=0;if(++r>4294967295)r=0}}return new LongBits(i,r)}static from(t){if("number"===typeof t)return LongBits.fromNumber(t);if(isString(t))if(Long)t=Long.fromString(t);else return LongBits.fromNumber(parseInt(t,10));return t.low||t.high?new LongBits(t.low>>>0,t.high>>>0):LongBits.zero}static fromHash(t){if(t===LongBits.zeroHash)return LongBits.zero;return new LongBits((charCodeAt(t,0)|charCodeAt(t,1)<<8|charCodeAt(t,2)<<16|charCodeAt(t,3)<<24)>>>0,(charCodeAt(t,4)|charCodeAt(t,5)<<8|charCodeAt(t,6)<<16|charCodeAt(t,7)<<24)>>>0)}toNumber(t=false){if(!t&&this.hi>>>31){const t=~this.lo+1>>>0;let o=~this.hi>>>0;if(!t)o=o+1>>>0;return-(t+4294967296*o)}return this.lo+4294967296*this.hi}toLong(t=false){return new Long(0|this.lo,0|this.hi,Boolean(t))}toHash(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)}zzEncode(){const t=this.hi>>31;this.hi=((this.hi<<1|this.lo>>>31)^t)>>>0;this.lo=(this.lo<<1^t)>>>0;return this}zzDecode(){const t=-(1&this.lo);this.lo=((this.lo>>>1|this.hi<<31)^t)>>>0;this.hi=(this.hi>>>1^t)>>>0;return this}length(){const t=this.lo;const o=(this.lo>>>28|this.hi<<4)>>>0;const i=this.hi>>>24;const r=128;const s=16384;const n=2097152;if(0!==i)return i<r?9:10;if(0===o)return t<s?t<r?1:2:t<n?3:4;return o<s?o<r?5:6:o<n?7:8}}const charCodeAt=(t,o)=>String.prototype.charCodeAt.call(t,o);const zero=LongBits.zero;zero.toNumber=()=>0;zero.zzEncode=zero.zzDecode=()=>zero;zero.length=()=>1;export function longToHash(t){return t?LongBits.from(t).toHash():LongBits.zeroHash}export function longFromHash(t,o=false){const i=LongBits.fromHash(t);if(Long)return Long.fromBits(i.lo,i.hi,o);return i.toNumber(Boolean(o))}