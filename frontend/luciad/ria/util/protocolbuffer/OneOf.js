import{isField}from"./interfaces.js";import{ReflectionObject}from"./ReflectionObject.js";import*as util from"./util.js";import{oneOfGetter,oneOfSetter}from"./util/util.js";export class OneOf extends ReflectionObject{static className="OneOf";constructor(e,t,r,o){if(!Array.isArray(t)){o=r;r=t;t=void 0}super(e,r);this._PB_ONE_OF=true;if(!(void 0===t||Array.isArray(t)))throw TypeError("fieldNames must be an Array");this.oneof=t||[];this.fieldsArray=[];this.comment=o??null}static fromJSON(e,t){return new OneOf(e,t.oneof,t.options,t.comment??void 0)}static d(...e){return(t,r)=>{util.decorateType(t.constructor).add(new OneOf(r,e));Object.defineProperty(t,r,{get:oneOfGetter(e),set:oneOfSetter(e)})}}toJSON(e){const t=Boolean(e?.keepComments);const{options:r,oneof:o,comment:i}=this;const s={options:r,oneof:o};if(t&&null!==i)s.comment=i;return s}add(e){if(!isField(e))throw TypeError("field must be a Field");if(e.parent&&e.parent!==this.parent)e.parent.remove(e);this.oneof.push(e.name);this.fieldsArray.push(e);e.partOf=this;addFieldsToParent(this);return this}remove(e){if(!isField(e))throw TypeError("field must be a Field");let t=this.fieldsArray.indexOf(e);if(t<0)throw Error(e+" is not a member of "+this);this.fieldsArray.splice(t,1);t=this.oneof.indexOf(e.name);if(t>-1)this.oneof.splice(t,1);e.partOf=null;return this}onAdd(e){super.onAdd(e);const t=this;for(let r=0;r<this.oneof.length;++r){const o=e.get(this.oneof[r]);if(o&&!o.partOf){o.partOf=t;t.fieldsArray.push(o)}}addFieldsToParent(this)}onRemove(e){for(let e=0;e<this.fieldsArray.length;++e){const t=this.fieldsArray[e];t.parent?.remove(t)}super.onRemove(e)}}function addFieldsToParent(e){if(e.parent)for(let t=0;t<e.fieldsArray.length;++t)if(!e.fieldsArray[t].parent)e.parent.add(e.fieldsArray[t])}