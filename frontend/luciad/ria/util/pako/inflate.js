import{inflate as zlib_inflate}from"./zlib/inflate.js";import{common as utils}from"./utils/common.js";import{strings}from"./utils/strings.js";import{constants}from"./zlib/constants.js";import{messages as msg}from"./zlib/messages.js";import{zstream as ZStream}from"./zlib/zstream.js";import{gzheader as GZheader}from"./zlib/gzheader.js";var toString=Object.prototype.toString;function Inflate(t){if(!(this instanceof Inflate))return new Inflate(t);this.options=utils.assign({chunkSize:16384,windowBits:0,to:""},t||{});var i=this.options;if(i.raw&&i.windowBits>=0&&i.windowBits<16){i.windowBits=-i.windowBits;if(0===i.windowBits)i.windowBits=-15}if(i.windowBits>=0&&i.windowBits<16&&!(t&&t.windowBits))i.windowBits+=32;if(i.windowBits>15&&i.windowBits<48)if(0===(15&i.windowBits))i.windowBits|=15;this.err=0;this.msg="";this.ended=false;this.chunks=[];this.strm=new ZStream;this.strm.avail_out=0;var n=zlib_inflate.inflateInit2(this.strm,i.windowBits);if(n!==constants.Z_OK)throw new Error(msg[n]);this.header=new GZheader;zlib_inflate.inflateGetHeader(this.strm,this.header);if(i.dictionary){if("string"===typeof i.dictionary)i.dictionary=strings.string2buf(i.dictionary);else if("[object ArrayBuffer]"===toString.call(i.dictionary))i.dictionary=new Uint8Array(i.dictionary);if(i.raw)if((n=zlib_inflate.inflateSetDictionary(this.strm,i.dictionary))!==constants.Z_OK)throw new Error(msg[n])}}Inflate.prototype.push=function(t,i){var n=this.strm;var s=this.options.chunkSize;var a=this.options.dictionary;var e,o;var r,f,u;var l=false;if(this.ended)return false;o=i===~~i?i:true===i?constants.Z_FINISH:constants.Z_NO_FLUSH;if("string"===typeof t)n.input=strings.binstring2buf(t);else if("[object ArrayBuffer]"===toString.call(t))n.input=new Uint8Array(t);else n.input=t;n.next_in=0;n.avail_in=n.input.length;do{if(0===n.avail_out){n.output=new utils.Buf8(s);n.next_out=0;n.avail_out=s}if((e=zlib_inflate.inflate(n,constants.Z_NO_FLUSH))===constants.Z_NEED_DICT&&a)e=zlib_inflate.inflateSetDictionary(this.strm,a);if(e===constants.Z_BUF_ERROR&&true===l){e=constants.Z_OK;l=false}if(e!==constants.Z_STREAM_END&&e!==constants.Z_OK){this.onEnd(e);this.ended=true;return false}if(n.next_out)if(0===n.avail_out||e===constants.Z_STREAM_END||0===n.avail_in&&(o===constants.Z_FINISH||o===constants.Z_SYNC_FLUSH))if("string"===this.options.to){r=strings.utf8border(n.output,n.next_out);f=n.next_out-r;u=strings.buf2string(n.output,r);n.next_out=f;n.avail_out=s-f;if(f)utils.arraySet(n.output,n.output,r,f,0);this.onData(u)}else this.onData(utils.shrinkBuf(n.output,n.next_out));if(0===n.avail_in&&0===n.avail_out)l=true}while((n.avail_in>0||0===n.avail_out)&&e!==constants.Z_STREAM_END);if(e===constants.Z_STREAM_END)o=constants.Z_FINISH;if(o===constants.Z_FINISH){e=zlib_inflate.inflateEnd(this.strm);this.onEnd(e);this.ended=true;return e===constants.Z_OK}if(o===constants.Z_SYNC_FLUSH){this.onEnd(constants.Z_OK);n.avail_out=0;return true}return true};Inflate.prototype.onData=function(t){this.chunks.push(t)};Inflate.prototype.onEnd=function(t){if(t===constants.Z_OK)if("string"===this.options.to)this.result=this.chunks.join("");else this.result=utils.flattenChunks(this.chunks);this.chunks=[];this.err=t;this.msg=this.strm.msg};function inflateFunc(t,i){var n=new Inflate(i);n.push(t,true);if(n.err)throw n.msg||msg[n.err];return n.result}function inflateRaw(t,i){(i=i||{}).raw=true;return inflateFunc(t,i)}var inflate={};utils.assign(inflate,{Inflate:Inflate,inflate:inflateFunc,inflateRaw:inflateRaw,ungzip:inflateFunc},constants);export{inflate};