import{common as utils}from"./common.js";var STR_APPLY_OK=true;var STR_APPLY_UIA_OK=true;var strings={};try{String.fromCharCode.apply(null,[0])}catch(r){STR_APPLY_OK=false}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(r){STR_APPLY_UIA_OK=false}var _utf8len=new utils.Buf8(256);for(var q=0;q<256;q++)_utf8len[q]=q>=252?6:q>=248?5:q>=240?4:q>=224?3:q>=192?2:1;_utf8len[254]=_utf8len[254]=1;strings.string2buf=function(r){var n,t,i,e,f,u=r.length,a=0;for(e=0;e<u;e++){if(55296===(64512&(t=r.charCodeAt(e)))&&e+1<u)if(56320===(64512&(i=r.charCodeAt(e+1)))){t=65536+(t-55296<<10)+(i-56320);e++}a+=t<128?1:t<2048?2:t<65536?3:4}n=new utils.Buf8(a);for(f=0,e=0;f<a;e++){if(55296===(64512&(t=r.charCodeAt(e)))&&e+1<u)if(56320===(64512&(i=r.charCodeAt(e+1)))){t=65536+(t-55296<<10)+(i-56320);e++}if(t<128)n[f++]=t;else if(t<2048){n[f++]=192|t>>>6;n[f++]=128|63&t}else if(t<65536){n[f++]=224|t>>>12;n[f++]=128|t>>>6&63;n[f++]=128|63&t}else{n[f++]=240|t>>>18;n[f++]=128|t>>>12&63;n[f++]=128|t>>>6&63;n[f++]=128|63&t}}return n};function buf2binstring(r,n){if(n<65534)if(r.subarray&&STR_APPLY_UIA_OK||!r.subarray&&STR_APPLY_OK)return String.fromCharCode.apply(null,utils.shrinkBuf(r,n));var t="";for(var i=0;i<n;i++)t+=String.fromCharCode(r[i]);return t}strings.buf2binstring=function(r){return buf2binstring(r,r.length)};strings.binstring2buf=function(r){var n=new utils.Buf8(r.length);for(var t=0,i=n.length;t<i;t++)n[t]=r.charCodeAt(t);return n};strings.buf2string=function(r,n){var t,i,e,f;var u=n||r.length;var a=new Array(2*u);for(i=0,t=0;t<u;){if((e=r[t++])<128){a[i++]=e;continue}if((f=_utf8len[e])>4){a[i++]=65533;t+=f-1;continue}e&=2===f?31:3===f?15:7;while(f>1&&t<u){e=e<<6|63&r[t++];f--}if(f>1){a[i++]=65533;continue}if(e<65536)a[i++]=e;else{e-=65536;a[i++]=55296|e>>10&1023;a[i++]=56320|1023&e}}return buf2binstring(a,i)};strings.utf8border=function(r,n){var t;if((n=n||r.length)>r.length)n=r.length;t=n-1;while(t>=0&&128===(192&r[t]))t--;if(t<0)return n;if(0===t)return n;return t+_utf8len[r[t]]>n?t:n};export{strings};