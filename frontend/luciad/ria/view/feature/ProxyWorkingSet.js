import{QueryStatus}from"./QueryStatus.js";import{createOptimizedEventedSupport}from"../../util/EventedSupport.js";export class ProxyWorkingSet{constructor(){this._eventSupport=createOptimizedEventedSupport(["QueryError","QueryFinished","QueryStarted","QuerySuccess","WorkingSetChanged","QueryInterrupted"],true);this._delegateWorkingSet=null;this._delayedOperations=[];this._delegateListeners=[]}on(e,t,r){return this._eventSupport.on(e,t,r)}setDelegateWorkingSet(e){this._delegateListeners.forEach((e=>e.remove()));this._delegateListeners=[];this.cancelPending();this._delegateWorkingSet?.workingSetUpdater?.release();this._delegateWorkingSet=e;if(e){["QueryError","QueryFinished","QueryStarted","QuerySuccess","QueryInterrupted"].forEach((t=>{this._delegateListeners.push(e.on(t,((...e)=>{this._eventSupport.emit(t,...e)})))}));this._delegateListeners.push(e.on("WorkingSetChanged",((e,t,r)=>{this._eventSupport.emitWorkingSetChangedEvent(e,t,r)})))}this._delayedOperations.forEach((e=>e()));this._delayedOperations=[]}isReady(){return this.queryStatus===QueryStatus.QUERY_FINISHED||this.queryStatus===QueryStatus.QUERY_ERROR}add(e,t){if(this._delegateWorkingSet)return this._delegateWorkingSet.add(e,t);return new Promise((r=>{this._delayedOperations.push((()=>{r(this._delegateWorkingSet.add(e,t))}))}))}cancelPending(){return this._delegateWorkingSet?.cancelPending()}put(e,t){if(this._delegateWorkingSet)return this._delegateWorkingSet.put(e,t);return new Promise((r=>{this._delayedOperations.push((()=>{r(this._delegateWorkingSet.put(e,t))}))}))}remove(e){if(this._delegateWorkingSet)return this._delegateWorkingSet.remove(e);return new Promise((t=>{this._delayedOperations.push((()=>{t(this._delegateWorkingSet.remove(e))}))}))}refreshWorkingSet(e){this._delegateWorkingSet?.refreshWorkingSet(e)}getIdMapSnapshot(){return this._delegateWorkingSet?.getIdMapSnapshot()??new Map}setSelected(e,t){return this._delegateWorkingSet?.setSelected(e,t)??null}setEdited(e,t){return this._delegateWorkingSet?.setEdited(e,t)??null}_registerPending(){this._delegateWorkingSet?._registerPending()}_registerStart(){this._delegateWorkingSet?._registerStart()}_registerSuccess(){this._delegateWorkingSet?._registerSuccess()}_registerError(e){this._delegateWorkingSet?._registerError(e)}_registerInterruption(){this._delegateWorkingSet?._registerInterruption()}_registerFinish(){return this._delegateWorkingSet?._registerFinish()}_clearData(){return this._delegateWorkingSet?._clearData()}clearAll(){this._delegateWorkingSet?.clearAll()}get(){return this._delegateWorkingSet?.get()??[]}getNode(e){return this._delegateWorkingSet?.getNode(e)??null}getFeature(e){return this._delegateWorkingSet?.getFeature(e)??null}search(e,t){this._delegateWorkingSet?.search(e,t)}forEachVisibleFeature(e){this._delegateWorkingSet?.forEachVisibleFeature(e)}forEachVisibleNode(e){this._delegateWorkingSet?.forEachVisibleNode(e)}forEachNode(e){this._delegateWorkingSet?.forEachNode(e)}_addObject(e,t){this._delegateWorkingSet?._addObject(e,t)}_updateObject(e,t){this._delegateWorkingSet?._updateObject(e,t)}_removeObject(e,t){this._delegateWorkingSet?._removeObject(e,t)}get bounds(){return this._delegateWorkingSet?this._delegateWorkingSet.bounds:null}get queryStatus(){return this._delegateWorkingSet?this._delegateWorkingSet.queryStatus:QueryStatus.QUERY_PENDING}}