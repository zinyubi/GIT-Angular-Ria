import{isArray,isBoolean,isString}from"../../util/Lang.js";import*as GEEDbRootDecoder from"./GEEDbRootDecoder.js";import{parseQuadTreePacketV1}from"./GEEMetadataV1Decoder.js";import{parseQuadTreePacketV2}from"./GEEMetadataV2Decoder.js";import{decode}from"./GEEPacketDecoder.js";export function isGeeServerDef(e){return isBoolean(e.isAuthenticated)&&isArray(e.layers)&&isString(e.serverUrl)}export function decodeQuadTreeMetadata(e,r=""){const t=decode(e);try{return parseQuadTreePacketV1(t,r)}catch(e){return parseQuadTreePacketV2(t,r)}}export const decodeRootDatabase=GEEDbRootDecoder.decodeRootDatabase;export function decodeImageryMetadata(e){if(null==e||!e.byteLength)throw new Error("No metadata could be decoded");const r=String.fromCharCode.apply(null,new Uint8Array(e));try{return JSON.parse(r)}catch(e){try{return JSON.parse(r.replace(/([\[{,])[\s ]*(\w+)[\s ]*:/g,'$1"$2":'))}catch(e){if(r.indexOf("function")>=0||r.indexOf("=>")>=0||r.indexOf("(")>=0||r.indexOf(")")>=0||r.indexOf("geeServerDefs")<0)throw new Error("Returned metadata was not in expected format and/or contained unsafe code that could not be evaluated.");return new Function(`return ${r}`)()}}}