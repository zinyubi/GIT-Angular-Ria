import{ProgrammingError}from"../../error/ProgrammingError.js";import{Photon}from"../../gen/photon/photon_painter.js";import{ObjectReleaseTracker}from"../../util/ObjectReleaseTracker.js";export class GEEPhotonVectorTileSetAdapter extends Photon.RiaVectorTileSet{constructor(e,t,r){super();this._vectorDecoder=t;this._tileSet=e;this._objectReleaseTracker=new ObjectReleaseTracker;this._reference=this._objectReleaseTracker.track(r.getReference(this._tileSet.reference));if(!this._reference)throw new ProgrammingError(`Invalid tile set reference identifier: ${this._tileSet.reference.identifier}`)}get vectorDecoder(){return this._vectorDecoder}get tileSet(){return this._tileSet}get geoReference(){return this._reference}set geoReference(e){throw new ProgrammingError("geoReference property is not mutable")}get tileSetBounds(){if(null==this._tileSet.bounds)throw new Error("tileSetBounds not initialized");return this._tileSet.bounds}get levelCount(){return this._tileSet.levelCount}set levelCount(e){throw new ProgrammingError("levelCount property is not mutable")}get minTileLevel(){return this._tileSet.minLevel}set minTileLevel(e){throw new ProgrammingError("levelCount property is not mutable")}get maxTileLevel(){return this._tileSet.maxLevel}set maxTileLevel(e){throw new ProgrammingError("levelCount property is not mutable")}destructor(){this._objectReleaseTracker.release()}release(){super.release();this._objectReleaseTracker.release()}requestVectorTile(e,t){return this._tileSet.getVectorTile(e,(r=>{const i=Photon.BufferFactory.createUint8BufferFromData(new Uint8Array(r.dataBuffer));t.tileVectorDataAvailable(e,i)}),(r=>{t.tileUnavailable(e,r)}))}getMinTileLevel(){return this.minTileLevel}getMaxTileLevel(){return this.maxTileLevel}getTileWidth(e){return this._tileSet.getTileWidth(e)??0}getTileHeight(e){return this._tileSet.getTileHeight(e)??0}getTileCountX(e){return this._tileSet.getTileColumnCount(e)??0}getTileCountY(e){return this._tileSet.getTileRowCount(e)??0}getBounds(e){if(null===this._tileSet.bounds)throw new Error("tileSetBounds not initialized");return this._tileSet.bounds}getTileBounds(e){const t=this._tileSet.bounds?.copy();if(!t)return null;t.width=(t?.width??1)/(this.getTileCountX(e.level)??1);t.height=(t?.height??1)/(this.getTileCountY(e.level)??1);t.x=t.x+e.x*t.width;t.y=t.y+e.y*t.height;return t}}