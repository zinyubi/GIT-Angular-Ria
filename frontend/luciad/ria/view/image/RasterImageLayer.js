import{Log}from"../../util/Log.js";import{releaseObject}from"../../util/ObjectReleaseTracker.js";import{PaintRepresentation}from"../PaintRepresentation.js";import{RasterLayer}from"../RasterLayer.js";import{RasterImageRenderer}from"./RasterImageRenderer.js";export class RasterImageLayer extends RasterLayer{constructor(e,r){super(e,r);this._invalidateHandle=null}isPaintRepresentationSupported(e){return PaintRepresentation.BODY===e}isReady(){return!this._renderer||this._renderer.isReady()}get model(){return super.model}_resetRenderer(e){releaseObject(this._renderer);if("Photon"===e.viewPaintingStrategy.techContext.type){Log.warn("LuciadRIA WebGLMap currently does not support RasterImageLayer");this.visibleSupported=false}else if(null!==this._map)this._renderer=new RasterImageRenderer(this,this._map)}_addedToMap(e){super._addedToMap(e);this._setModelToMapTransformation(e.reference);this._resetRenderer(e);if(this.model)this._invalidateHandle=this.model.on("Invalidated",(()=>{this._resetRenderer(e);this._invalidate()}))}calculateImageLocation(e,r){if(this._renderer)return this._renderer.calculateImageLocation(e,r);else return null}_removedFromMap(e){super._removedFromMap(e);this._renderer=releaseObject(this._renderer);if(this._invalidateHandle){this._invalidateHandle.remove();this._invalidateHandle=null}}}