import{Photon}from"../../../gen/photon/photon_painter.js";import{Log}from"../../../util/Log.js";import{isAttributedTileSet}from"../../../model/tileset/AttributedTileSet.js";import{HSPCTile}from"../../../model/tileset/HSPCTile.js";import{createPoint}from"../../../shape/ShapeFactory.js";export class PhotonScenePainterCallback extends Photon.ScenePainterCallback{constructor(e,t){super();this._photon=e;this._tilesetLayer=t}onBoundsAvailable(){}onError(e,t,o){if(0===t)Log.debug(o);else if(1===t)Log.log(o);else if(2===t){if(this._tilesetLayer.warningsEnabled)Log.warn(o)}else if(3===t)Log.error(o)}onSceneReadyChange(e){this._tilesetLayer.sceneReadyState=!!e}onTileLoadingChange(e,t){this._tilesetLayer.loadingStatus={tilesLoaded:e,tilesPending:t}}onTilesAttributionsChange(e){if(isAttributedTileSet(this._tilesetLayer.model))this._tilesetLayer.model.attributions=decodeEscapedString(e)}onTileDownloadedRIACallback(e,t,o,i,s,n,a){const l=()=>{o.release();i.release();n.release();a.release()};if(this._tilesetLayer.hasOnTileDownloadedCallback()){const e=i;const r=new HSPCTile(t,createPoint(null,[s.x,s.y,s.z]),e,n,o);this._tilesetLayer.onTileDownloaded(r,(e=>{a.onDataReady(e.rawData);l()}),l)}else l()}}function decodeEscapedString(e){let t=e.split(/(?<!\/)\|/);const o=[];for(const e of t){const t=undefined;const i=e.replace(/\/\|/g,"|").replace(/\/\//g,"/");o.push(i)}return o}