<div class="ltpanel" [class.collapsed]="collapsed">
  <!-- header -->
  <div class="ltpanel-header ltree-row">
    <span class="ltpanel-icon">‚ò∞</span>
    <span class="ltpanel-title">Layers</span>
    <button
      class="ltpanel-toggle"
      type="button"
      (click)="toggleCollapse()"
      title="Collapse/expand panel"
    >
      <span class="ltpanel-icon">‚ñ∏</span>
    </button>
  </div>

  <!-- body -->
  <div class="ltpanel-body">
    <ng-container *ngFor="let n of nodes; trackBy: trackNode">
      <ng-template #renderNode let-node>
        <div class="ltree-node"
             draggable="true"
             (dragstart)="dragStart(node, $event)"
             (dragover)="dragOverNode(node, $event)"
             (dragleave)="dragLeaveNode(node)"
             (drop)="dropOnNode(node, $event)">

          <div class="ltree-row"
               [class.drag-over-top]="isDragTop(node.id)"
               [class.drag-over-bottom]="isDragBottom(node.id)">

            <!-- caret / open-close -->

            <!-- <button
              type="button"
              class="ltree-btn"
              (click)="hasChildren(node) && toggleNodeExpand(node, $event)"
              [attr.aria-expanded]="node.expanded"
              title="Expand/collapse"
            >
              <span class="ltpanel-icon ltree-caret" [class.ltree-caret-open]="node.expanded">‚ñ∏</span>
            </button> -->

            <!-- icon + label -->
            <span class="ltpanel-icon ltree-type" [title]="node.iconTitle">{{ node.iconEmoji }}</span>
            <span class="ltree-label"
                  [title]="node.label"
                  (dblclick)="fitLayer(node, $event)">{{ node.label }}</span>

            <!-- right-side buttons -->
            <div class="ltree-actions">
              <button class="ltree-btn only-on-hover" (click)="fitLayer(node, $event)" title="Fit to data">‚§¢</button>
              <button class="ltree-btn only-on-hover" (click)="deleteLayer(node, $event)" title="Delete">üóë</button>
              <button class="ltree-btn ltree-visibility"
                      [class.visible]="node.visible"
                      (click)="toggleVisible(node, $event)"
                      title="Toggle visibility">üëÅ</button>
            </div>
          </div>

          <!-- children -->
          <div class="ltree-children" *ngIf="node.expanded && hasChildren(node)">
            <ng-container *ngFor="let c of node.children; trackBy: trackNode">
              <ng-container *ngTemplateOutlet="renderNode; context: {$implicit: c}"></ng-container>
            </ng-container>
          </div>
        </div>
      </ng-template>

      <ng-container *ngTemplateOutlet="renderNode; context: {$implicit: n}"></ng-container>
    </ng-container>
  </div>
</div>
