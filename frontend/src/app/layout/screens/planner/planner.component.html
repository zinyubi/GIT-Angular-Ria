<!-- ======= HEADER (auto height) ======= -->
<div class="planning-header"></div>

<!-- ======= WORKSPACE GRID: rail | map | right-rail | inspector ======= -->
<div
  class="planning-workspace"
  [class.is-collapsed]="sidebarCollapsed"
  [class.no-inspector]="!selectedScenario"
  [class.inspector-collapsed]="inspectorCollapsed"
>

  <!-- ============== LEFT: SCENARIOS RAIL ============== -->
  <app-scenarios-rail
    class="rail-sidebar"
    [collapsed]="sidebarCollapsed"
    [scenarios]="scenarios"
    [selectedScenario]="selectedScenario"
    [editing]="editing"
    [form]="form"
    [errorMessage]="scenarioError"
    (collapseChange)="sidebarCollapsed = $event"
    (createScenario)="handleCreateScenario()"
    (editScenario)="handleEditScenario()"
    (cancelEdit)="handleCancelEditScenario()"
    (saveScenario)="handleSaveScenario()"
    (deleteScenario)="handleDeleteScenario($event)"
    (selectScenario)="handleSelect($event)"
    (expandTo)="expandAnd($event)"
  ></app-scenarios-rail>

  <!-- ============== CENTER: MAP (dominant) ============== -->
  <app-map-panel
    class="map-wrap"
    [scenario]="selectedScenario"
    [deployedAircrafts]="deployedAircrafts"
    (pointPicked)="handlePointPicked($event)"
  ></app-map-panel>

  <!-- ============== RIGHT: MINI RAIL (like left side) ============== -->
  <div class="right-rail" *ngIf="selectedScenario">
    <button
      class="right-rail-btn"
      type="button"
      (click)="inspectorCollapsed = !inspectorCollapsed"
      [attr.aria-label]="inspectorCollapsed ? 'Expand tools panel' : 'Collapse tools panel'"
    >
      <!-- Expanded → arrow points right (collapse) -->
      <span *ngIf="!inspectorCollapsed">›</span>
      <!-- Collapsed → arrow points left (expand) -->
      <span *ngIf="inspectorCollapsed">‹</span>
    </button>
  </div>

  <!-- ============== RIGHT: INSPECTOR (tools) ============== -->
  <section
    class="inspector"
    aria-label="Scenario tools"
    *ngIf="selectedScenario"
  >
    <div class="inspector-inner">

      <!-- ===== Default: Deployment + Deployed list ===== -->
      <ng-container *ngIf="!editorOpen; else editorPane">
        <app-deployment-form
          class="inspector-card"
          [open]="deployOpen"
          [aircraftTypes]="aircraftTypes"
          [formValue]="newAircraftForm"
          [deploying]="deploying"
          (openChange)="onDeployOpenChange($event)"
          (requestPick)="beginPick('deploy-latlon')"
          (deploy)="handleDeployAircraft()"
          (formValueChange)="newAircraftForm = $event"
        ></app-deployment-form>

        <app-deployed-aircraft-list
          class="inspector-card inspector-card--list"
          *ngIf="deployedAircrafts?.length"
          [aircrafts]="deployedAircrafts"
          (edit)="startEditAircraft($event)"
          (remove)="removeAircraft($event)"
        ></app-deployed-aircraft-list>
      </ng-container>

      <!-- ===== Editor mode: aircraft editor fills inspector ===== -->
      <ng-template #editorPane>
        <app-aircraft-editor
          class="inspector-card inspector-editor"
          [open]="editorOpen"
          [aircraft]="editingAircraft"
          [waypointForm]="waypointForm"
          [waypointEditIndex]="waypointEditIndex"
          (openChange)="onEditorOpenChange($event)"
          (saveAircraft)="saveAircraft()"
          (cancelAircraft)="cancelEditAircraft()"
          (requestPickWaypoint)="beginPick('waypoint')"
          (editWaypoint)="editWaypoint($event)"
          (deleteWaypoint)="deleteWaypoint($event)"
          (saveWaypoint)="saveWaypoint()"
          (waypointFormChange)="onWaypointFormChange($event)"
          (requestPickInitial)="beginPick('edit-initial')"
        ></app-aircraft-editor>
      </ng-template>
    </div>
  </section>
</div>
