<!-- ======= HEADER (auto height) ======= -->
<div class="planning-header"></div>

<!-- ======= WORKSPACE GRID (fills the rest of the screen) ======= -->
<div class="planning-workspace" [class.is-collapsed]="sidebarCollapsed"  [class.no-tools]="!selectedScenario" >

  <!-- ============== LEFT: SIDEBAR ============== -->
  <app-scenarios-rail
    class="rail-sidebar"
    [collapsed]="sidebarCollapsed"
    [scenarios]="scenarios"
    [selectedScenario]="selectedScenario"
    [editing]="editing"
    [form]="form"
    [errorMessage]="scenarioError"
    (collapseChange)="sidebarCollapsed = $event"
    (createScenario)="handleCreateScenario()"
    (editScenario)="handleEditScenario()"
    (cancelEdit)="handleCancelEditScenario()"
    (saveScenario)="handleSaveScenario()"
    (deleteScenario)="handleDeleteScenario($event)"
    (selectScenario)="handleSelect($event)"
    (expandTo)="expandAnd($event)"
  ></app-scenarios-rail>

  <!-- ============== CENTER: TOOLS ============== -->
  <section class="tools" aria-label="Tools" data-single-open *ngIf="selectedScenario">

    <!-- ===== Group A: (2) List + (3) Deployment ===== -->
    <div class="tools-group tools-planning" *ngIf="!editorOpen ">
      <!-- Deployment form -->
      <app-deployment-form
        [open]="deployOpen"
        [aircraftTypes]="aircraftTypes"
        [formValue]="newAircraftForm"
        [deploying]="deploying"
        (openChange)="onDeployOpenChange($event)"
        (requestPick)="beginPick('deploy-latlon')"
        (deploy)="handleDeployAircraft()"
        (formValueChange)="newAircraftForm = $event"
      ></app-deployment-form>

      <!-- Deployed list (always visible within planning group if items exist) -->
      <app-deployed-aircraft-list
        *ngIf="deployedAircrafts?.length"
        [aircrafts]="deployedAircrafts"
        (edit)="startEditAircraft($event)"
      ></app-deployed-aircraft-list>
    </div>

    <!-- ===== Group B: (1) Editor ===== -->
    <div class="tools-group tools-editor" *ngIf="editorOpen">
      <app-aircraft-editor
        [open]="editorOpen"
        [aircraft]="editingAircraft"
        [waypointForm]="waypointForm"
        [waypointEditIndex]="waypointEditIndex"
        (openChange)="onEditorOpenChange($event)"
        (saveAircraft)="saveAircraft()"
        (cancelAircraft)="cancelEditAircraft()"
        (requestPickWaypoint)="beginPick('waypoint')"
        (editWaypoint)="editWaypoint($event)"
        (deleteWaypoint)="deleteWaypoint($event)"
        (saveWaypoint)="saveWaypoint()"
        (waypointFormChange)="waypointForm = { lat: $event.lat ?? null, lon: $event.lon ?? null, alt: $event.alt ?? null }"

        (requestPickInitial)="beginPick('edit-initial')"
      ></app-aircraft-editor>
    </div>

  </section>

  <!-- ============== RIGHT: MAP ============== -->
    <app-map-panel
    class="map-wrap"
    [scenario]="selectedScenario"
    (pointPicked)="handlePointPicked($event)"
  ></app-map-panel>



</div>
