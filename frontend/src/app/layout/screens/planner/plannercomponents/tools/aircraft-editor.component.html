<article class="ae-card" role="region" aria-label="Aircraft Editor">

  <!-- Header -->
  <header class="ae-header">
    <div class="ae-title">
      <h3>Aircraft Editor</h3>
      <small *ngIf="aircraft?.name" class="ae-subtle">
        Editing: {{ aircraft.name }}
      </small>
    </div>
  </header>

  <!-- ================= BODY ================= -->
  <div class="ae-body" *ngIf="aircraft; else pickAircraft">

    <!-- Scrollable content -->
    <div class="ae-scroll">

      <!-- Initial position -->
      <section class="ae-section">
        <div class="ae-section-head"><h4>Initial Position</h4></div>

        <div class="ae-grid ae-grid-2">

          <!-- LAT -->
          <label class="ae-field">
            <span class="ae-label">Latitude</span>
            <input class="ae-input" type="number" step="any"
              [(ngModel)]="aircraft!.initial_latitude" />
          </label>

          <!-- LON -->
          <label class="ae-field">
            <span class="ae-label">Longitude</span>
            <input class="ae-input" type="number" step="any"
              [(ngModel)]="aircraft!.initial_longitude" />
          </label>

          <!-- ALT -->
          <label class="ae-field">
            <span class="ae-label">Altitude (m)</span>
            <input class="ae-input" type="number" step="1"
              [(ngModel)]="aircraft!.initial_altitude_m" />
          </label>

          <div class="ae-field ae-align-end">
            <button type="button" class="ae-btn ae-btn-ghost ae-btn-map"
              (click)="requestPickInitial.emit()">
              üìç Pick from map
            </button>
          </div>
        </div>
      </section>

      <hr class="ae-divider" />

      <!-- WAYPOINT LIST -->
      <section class="ae-section ae-section--wp">
        <div class="ae-section-head"><h4>Waypoints</h4></div>

        <div class="ae-wp-list" *ngIf="aircraft!.planned_waypoints?.length; else noWp">
          <div class="ae-wp-item" *ngFor="let wp of aircraft!.planned_waypoints; let i=index">
            <div class="ae-wp-values">
              <span class="ae-chip">Lat <code>{{ wp.lat | number:'1.5-5' }}</code></span>
              <span class="ae-chip">Lon <code>{{ wp.lon | number:'1.5-5' }}</code></span>
              <span class="ae-chip" [class.ae-chip-alt--empty]="wp.alt == null">
                Alt
                <code>
                  {{ wp.alt == null ? '‚Äî' : (wp.alt | number:'1.0-0') }}
                  <span *ngIf="wp.alt != null"> m</span>
                </code>
              </span>
            </div>

            <div class="ae-wp-actions">
              <button class="ae-icon" (click)="editWaypoint.emit(i)">‚úé</button>
              <button class="ae-icon ae-danger" (click)="deleteWaypoint.emit(i)">üóëÔ∏è</button>
            </div>
          </div>
        </div>

        <ng-template #noWp>
          <p class="ae-hint">No waypoints added yet.</p>
        </ng-template>

      </section>
    </div>

    <!-- ================= FIXED BOTTOM EDITOR ================= -->
    <form class="ae-wp-editor" (submit)="$event.preventDefault()">
      <div class="ae-section-head"><h4>Add Waypoints</h4></div>

      <!-- LAT / LON -->
      <div class="ae-grid ae-grid-2 ae-wp-grid">

        <label class="ae-field">
          <span class="ae-label">Latitude</span>
          <input class="ae-input" type="number" step="any"
            [(ngModel)]="waypointForm.lat"
            name="wpLat"
            (ngModelChange)="updateField('lat', $event)" />
        </label>

        <label class="ae-field">
          <span class="ae-label">Longitude</span>
          <input class="ae-input" type="number" step="any"
            [(ngModel)]="waypointForm.lon"
            name="wpLon"
            (ngModelChange)="updateField('lon', $event)" />
        </label>

      </div>

      <!-- ALT -->
      <div class="ae-grid ae-grid-2 ae-wp-grid">
        <label class="ae-field">
          <span class="ae-label">Altitude (m)</span>
          <input class="ae-input" type="number" step="1"
            [(ngModel)]="waypointForm.alt"
            name="wpAlt"
            (ngModelChange)="updateField('alt', $event)" />
        </label>
        <div></div>
      </div>

      <div class="ae-wp-actions-row">
        <button class="ae-btn ae-btn-ghost ae-btn-map"
          (click)="requestPickWaypoint.emit()">üìç Pick</button>

        <button class="ae-btn ae-btn-primary"
          (click)="saveWaypoint.emit()">Save</button>

        <button class="ae-btn ae-btn-secondary"
          (click)="resetWpForm()">Cancel</button>
      </div>

    </form>

  </div>

  <!-- Empty state -->
  <ng-template #pickAircraft>
    <div class="ae-empty">
      <p>Select a deployed aircraft from the list to start editing.</p>
    </div>
  </ng-template>

  <!-- FOOTER -->
  <footer class="ae-footer">
    <div class="ae-footer-actions">
      <button class="ae-btn ae-btn-secondary" (click)="cancelAircraft.emit()">Cancel</button>
      <button class="ae-btn ae-btn-primary" (click)="saveAircraft.emit()">Save Aircraft</button>
    </div>
  </footer>

</article>
