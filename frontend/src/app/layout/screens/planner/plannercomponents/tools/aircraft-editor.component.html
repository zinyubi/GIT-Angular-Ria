<article class="ae-card" role="region" aria-label="Aircraft Editor">
  <!-- Header -->
  <header class="ae-header">
    <div class="ae-title">
      <h3>Aircraft Editor</h3>
      <small *ngIf="aircraft?.name" class="ae-subtle">Editing: {{ aircraft.name }}</small>
    </div>
    <div class="ae-header-actions"><!-- reserved --></div>
  </header>

  <!-- Body (scrolls) -->
  <div class="ae-body" *ngIf="aircraft; else pickAircraft">

    <!-- ========== Section: Initial Position ========== -->
    <section class="ae-section">
      <div class="ae-section-head"><h4>Initial Position</h4></div>

      <div class="ae-grid ae-grid-2">
        <label class="ae-field">
          <span class="ae-label">Latitude</span>
          <input class="ae-input" type="number" step="any"
                 [(ngModel)]="aircraft!.initial_latitude" name="editLatitude" placeholder="e.g. 23.0219" />
        </label>

        <label class="ae-field">
          <span class="ae-label">Longitude</span>
          <input class="ae-input" type="number" step="any"
                 [(ngModel)]="aircraft!.initial_longitude" name="editLongitude" placeholder="e.g. 72.5797" />
        </label>

        <label class="ae-field">
          <span class="ae-label">Altitude (m)</span>
          <input class="ae-input" type="number" step="1"
                 [(ngModel)]="aircraft!.initial_altitude_m" name="editAltitude" placeholder="e.g. 2500" />
        </label>

        <div class="ae-field ae-align-end">
          <button type="button" class="ae-btn ae-btn-ghost ae-btn-map"
                  (click)="requestPickInitial.emit()" aria-label="Pick initial position from map">
            ğŸ“ Pick from map
          </button>
        </div>
      </div>
    </section>

    <hr class="ae-divider" />

    <!-- ========== Section: Waypoints ========== -->
    <section class="ae-section">
      <div class="ae-section-head"><h4>Waypoints</h4></div>

      <!-- List of existing waypoints -->
      <div class="ae-wp-list" *ngIf="aircraft!.planned_waypoints?.length; else noWp">
        <div class="ae-wp-item" *ngFor="let wp of aircraft!.planned_waypoints; let i = index">
          <div class="ae-wp-values">
            <span class="ae-chip">Lat <code>{{ wp.lat | number:'1.5-5' }}</code></span>
            <span class="ae-chip">Lon <code>{{ wp.lon | number:'1.5-5' }}</code></span>
            <span class="ae-chip">
              Alt
              <code>{{ wp.alt == null ? 'â€”' : (wp.alt | number:'1.0-0') }}<span *ngIf="wp.alt != null"> m</span></code>
            </span>
          </div>
          <div class="ae-wp-actions">
            <button type="button" class="ae-icon" (click)="editWaypoint.emit(i)" title="Edit waypoint">âœ</button>
            <button type="button" class="ae-icon ae-danger" (click)="deleteWaypoint.emit(i)" title="Delete waypoint">ğŸ—‘ï¸</button>
          </div>
        </div>
      </div>
      <ng-template #noWp>
        <p class="ae-hint">No waypoints added yet.</p>
      </ng-template>

      <!-- Clean, collision-proof add/edit row -->
      <form class="ae-wp-editor" (submit)="$event.preventDefault()">
        <!-- Row 1: Lat | Lon -->
        <div class="ae-grid ae-grid-2 ae-wp-grid">
          <label class="ae-field">
            <span class="ae-label">Latitude</span>
            <input class="ae-input" type="number" step="any"
                   [(ngModel)]="waypointForm.lat" name="wpLat"
                   (ngModelChange)="waypointFormChange.emit(waypointForm)" />
          </label>

          <label class="ae-field">
            <span class="ae-label">Longitude</span>
            <input class="ae-input" type="number" step="any"
                   [(ngModel)]="waypointForm.lon" name="wpLon"
                   (ngModelChange)="waypointFormChange.emit(waypointForm)" />
          </label>
        </div>

        <!-- Row 2: Alt (m) -->
        <div class="ae-grid ae-grid-2 ae-wp-grid">
          <label class="ae-field">
            <span class="ae-label">Altitude (m)</span>
            <input class="ae-input" type="number" step="1"
                   [(ngModel)]="waypointForm.alt" name="wpAlt"
                   (ngModelChange)="waypointFormChange.emit(waypointForm)" />
          </label>
          <div><!-- empty to keep symmetry --></div>
        </div>

        <!-- Row 3: actions (full width, right aligned) -->
        <div class="ae-wp-actions-row">
          <button type="button" class="ae-btn ae-btn-ghost ae-btn-map"
                  (click)="requestPickWaypoint.emit()" title="Pick waypoint on map">ğŸ“ Pick</button>
          <button type="button" class="ae-btn ae-btn-primary" (click)="saveWaypoint.emit()">Save</button>
          <button type="button" class="ae-btn ae-btn-secondary" (click)="resetWpForm()">Cancel</button>
        </div>
      </form>
    </section>
  </div>

  <!-- Empty state -->
  <ng-template #pickAircraft>
    <div class="ae-empty"><p>Select a deployed aircraft from the list to start editing.</p></div>
  </ng-template>

  <!-- Footer (sticky) -->
  <footer class="ae-footer">
    <div class="ae-footer-actions">
      <button type="button" class="ae-btn ae-btn-secondary" (click)="cancelAircraft.emit()">Cancel</button>
      <button type="button" class="ae-btn ae-btn-primary" (click)="saveAircraft.emit()">Save Aircraft</button>
    </div>
  </footer>
</article>
