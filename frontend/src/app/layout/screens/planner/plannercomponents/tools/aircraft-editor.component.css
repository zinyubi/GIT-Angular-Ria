:host{
  display:block; block-size:100%; min-block-size:0;
  color: var(--color-text, #e7ecf6);
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;

  /* === Derive local palette from global theme tokens === */
  --ae-surface:    var(--color-surface, #10131a);
  --ae-panel:      color-mix(in srgb, var(--color-surface, #10131a) 92%, transparent);
  --ae-header:     color-mix(in srgb, var(--color-surface, #10131a) 88%, black 12%);
  --ae-border:     var(--color-border, #242938);
  --ae-ctrl:       color-mix(in srgb, var(--color-surface, #10131a) 86%, black 14%);
  --ae-ctrl-bd:    color-mix(in srgb, var(--ae-ctrl) 80%, #000 20%);
  --ae-accent:     var(--color-accent, #ff5773);
  --ae-accent-2:   var(--color-success, #0d6efd);
  --ae-muted:      var(--color-muted, #a9b3cc);
  --ae-chip-bg:    color-mix(in srgb, var(--ae-ctrl) 78%, transparent 22%);
  --ae-tile:       color-mix(in srgb, var(--ae-ctrl) 92%, black 8%);
  --ae-danger:     var(--color-error, #ff4d6d);
  --ae-focus-ring: color-mix(in srgb, var(--ae-accent) 25%, transparent);
}

/* ===== Card grid: header | body | footer ===== */
.ae-card{
  display:grid; grid-template-rows:auto 1fr auto;
  block-size:100%; min-block-size:0; overflow:hidden;
  background:var(--ae-surface);
  border:1px solid var(--ae-border);
  border-radius:12px;
  box-shadow:0 0 0 1px color-mix(in srgb, var(--ae-border) 22%, transparent);
}

/* ===== Header (compact, sticky) ===== */
.ae-header{
  position: sticky; inset-block-start: 0; z-index: 1;
  display:flex; align-items:center; justify-content:space-between; gap:.6rem;
  background:var(--ae-header);
  padding:.65rem .9rem;
  border-bottom:1px solid var(--ae-border);
}
.ae-title h3{ margin:0; font-size:1rem; letter-spacing:.2px; }
.ae-subtle{ color:var(--ae-muted); display:block; margin-top:2px; font-size:.85rem; }
.ae-header-actions{ display:flex; gap:.45rem; }

/* ===== Scroll body ===== */
.ae-body{
  min-block-size:0; overflow:auto;
  padding:.8rem; background:var(--ae-panel);
}

/* ===== Footer ===== */
.ae-footer{
  background:var(--ae-header);
  border-top:1px solid var(--ae-border);
  padding:.6rem .9rem;
}
.ae-footer-actions{ display:flex; justify-content:flex-end; gap:.5rem; flex-wrap:wrap; }

/* ===== Sections ===== */
.ae-section{ display:flex; flex-direction:column; gap:.7rem; }
.ae-section-head h4{ margin:0; font-size:.95rem; font-weight:700; }
.ae-divider{ border:none; border-top:1px solid var(--ae-border); margin:.7rem 0; }

/* ===== Layout grids ===== */
.ae-grid{ display:grid; gap:.6rem; }
.ae-grid-2{ grid-template-columns:repeat(2,minmax(0,1fr)); }
@media (max-width:820px){ .ae-grid-2{ grid-template-columns:1fr 1fr; } }
@media (max-width:560px){ .ae-grid-2{ grid-template-columns:1fr; } }
.ae-grid>*{ min-width:0; }

.ae-field{ display:grid; gap:.3rem; min-width:0; }
.ae-align-end{ display:flex; align-items:end; }

/* ===== Labels & Inputs ===== */
.ae-label{ font-size:.88rem; font-weight:600; color: color-mix(in srgb, var(--ae-muted) 85%, white 15%); }
.ae-input{
  inline-size:100%; box-sizing:border-box;
  block-size:38px; padding:0 .7rem;
  border-radius:10px; border:1px solid var(--ae-ctrl-bd);
  background:var(--ae-ctrl); color: var(--color-text, #e7ecf6);
}
.ae-input::placeholder{ color: color-mix(in srgb, var(--ae-muted) 70%, transparent 30%); }
.ae-input:focus{
  outline:none; border-color:var(--ae-accent);
  box-shadow:0 0 0 3px var(--ae-focus-ring);
}

/* Invalid hint (optional) */
.ae-input:invalid{ border-color: var(--ae-danger); }

/* ===== Buttons ===== */
.ae-btn{
  padding:.48rem .9rem; border-radius:10px;
  font-weight:600; border:1px solid transparent; cursor:pointer;
  transition:filter .15s ease, background .15s ease, border-color .15s ease;
}
.ae-btn:active{ transform: translateY(1px); }

.ae-btn-primary{ background:var(--ae-accent); color:#fff; }
.ae-btn-primary:hover{ filter:brightness(1.08); }

.ae-btn-secondary{
  background: var(--ae-ctrl); color: var(--color-text, #e7ecf6);
  border:1px solid var(--ae-ctrl-bd);
}
.ae-btn-secondary:hover{ background: color-mix(in srgb, var(--ae-ctrl) 88%, white 12%); }

.ae-btn-ghost{
  background: var(--ae-ctrl); color: var(--color-text, #e7ecf6);
  border:1px solid var(--ae-ctrl-bd);
}
.ae-btn-ghost:hover{ background: color-mix(in srgb, var(--ae-ctrl) 85%, white 15%); }

.ae-btn-map{ white-space:nowrap; max-width:100%; }

/* ===== Waypoints list ===== */
.ae-wp-list{ display:flex; flex-direction:column; gap:.55rem; }
.ae-wp-item{
  display:grid; grid-template-columns:1fr auto; align-items:center; gap:.6rem;
  background: var(--ae-tile);
  border:1px solid var(--ae-ctrl-bd); border-radius:12px;
  padding:.55rem .65rem;
  transition:border-color .15s ease, background .15s ease;
}
.ae-wp-item:hover{
  border-color: var(--ae-accent);
  background: color-mix(in srgb, var(--ae-tile) 88%, var(--ae-accent) 12%);
}

.ae-wp-values{ display:flex; flex-wrap:wrap; gap:.4rem; min-width:0; }
.ae-chip{
  display:inline-flex; align-items:center; gap:.3rem;
  padding:.24rem .5rem; border-radius:999px;
  font-size:.82rem; background: var(--ae-chip-bg);
  border:1px solid var(--ae-ctrl-bd);
}
.ae-chip code{
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  font-size:.82rem; color: var(--color-text, #e7ecf6);
}

.ae-wp-actions{ display:flex; gap:.35rem; }

/* Icon buttons */
.ae-icon{
  inline-size:32px; block-size:32px; min-inline-size:32px;
  border-radius:10px; border:1px solid var(--ae-ctrl-bd);
  background:var(--ae-ctrl); color: var(--color-text, #e7ecf6);
  display:inline-flex; align-items:center; justify-content:center; cursor:pointer;
}
.ae-icon:hover{ background: color-mix(in srgb, var(--ae-ctrl) 85%, white 15%); border-color: var(--ae-accent); }
.ae-icon.ae-danger:hover{
  background: color-mix(in srgb, var(--ae-danger) 26%, var(--ae-ctrl) 74%);
  border-color: var(--ae-danger);
}

/* ===== Waypoint inline editor ===== */
.ae-wp-editor{
  margin-top:.35rem; padding:.65rem;
  background: var(--ae-tile); border:1px solid var(--ae-ctrl-bd);
  border-radius:12px; display:grid; gap:.55rem;
}
.ae-wp-editor .ae-grid>*,
.ae-wp-editor .ae-field{ min-width:0; }

.ae-wp-actions-row{
  display:flex; justify-content:flex-end; gap:.4rem; flex-wrap:wrap;
}

/* ===== Empty state ===== */
.ae-empty{ display:grid; place-items:center; color: var(--ae-muted); padding:1rem; }
.ae-hint{ color: var(--ae-muted); margin:.15rem 0 0; }

/* ===== Scrollbar cosmetics (optional) ===== */
.ae-body::-webkit-scrollbar{ width:10px; }
.ae-body::-webkit-scrollbar-thumb{
  background: color-mix(in srgb, var(--ae-ctrl-bd) 78%, transparent);
  border-radius:6px;
}
.ae-body::-webkit-scrollbar-track{ background: var(--ae-surface); }

/* ===== Focus-visible for a11y ===== */
:where(button,.ae-input,.ae-icon,.ae-btn):focus-visible{
  outline:2px solid color-mix(in srgb, var(--ae-accent) 55%, transparent);
  outline-offset:2px;
}

/* ===== Reduced motion ===== */
@media (prefers-reduced-motion: reduce){
  *{ transition-duration:.001ms !important; animation-duration:.001ms !important; }
}
